<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"fangjun120.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="eidolon的小窝">
<meta property="og:url" content="https://fangjun120.github.io/page/6/index.html">
<meta property="og:site_name" content="eidolon的小窝">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Fang Jun">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://fangjun120.github.io/page/6/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>eidolon的小窝</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">eidolon的小窝</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">做有趣的人</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fangjun120.github.io/2022/02/10/00-00-00/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Fang Jun">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="eidolon的小窝">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/02/10/00-00-00/" class="post-title-link" itemprop="url">egg框架</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-02-10 00:00:00" itemprop="dateCreated datePublished" datetime="2022-02-10T00:00:00+08:00">2022-02-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-04-09 10:21:09" itemprop="dateModified" datetime="2023-04-09T10:21:09+08:00">2023-04-09</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/node/" itemprop="url" rel="index"><span itemprop="name">node</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>Eggjs是一个基于Koajs的框架，所以它应当属于框架之上的框架，它继承了Koa的高性能优点，同时又加入了一些约束与开发规范，来规避Koajs框架本身的开发自由度太高的问题。</p>
<p>Koajs是一个nodejs中比较基层的框架，它本身没有太多约束与规范，自由度非常高，每一个开发者实现自己的服务的时候，都有自己的“骚操作”。而egg为了适应企业开发，加了一些开发时的规范与约束，从而解决Koajs这种自由度过高而导致不适合企业内使用的缺点，Egg便在这种背景下诞生。</p>
<h2 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h2><ul>
<li>约定大于配置</li>
<li>提供基于 Egg <a href="https://link.juejin.cn/?target=https://eggjs.org/zh-cn/advanced/framework.html">定制上层框架</a>的能力</li>
<li>高度可扩展的<a href="https://link.juejin.cn/?target=https://eggjs.org/zh-cn/basics/plugin.html">插件机制</a></li>
<li>内置<a href="https://link.juejin.cn/?target=https://eggjs.org/zh-cn/advanced/cluster-client.html">多进程管理</a></li>
<li>基于 <a href="https://link.juejin.cn/?target=http://koajs.com/">Koa</a> 开发，性能优异</li>
<li>框架稳定，测试覆盖率高</li>
<li><a href="https://link.juejin.cn/?target=https://eggjs.org/zh-cn/tutorials/progressive.html">渐进式开发</a></li>
</ul>
<h2 id="环境搭建、创建、运行"><a href="#环境搭建、创建、运行" class="headerlink" title="环境搭建、创建、运行"></a>环境搭建、创建、运行</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">脚手架搭建项目</span><br><span class="line">$ npm init egg --type=simple</span><br><span class="line">$ npm i</span><br><span class="line">启动项目</span><br><span class="line">$ npm run dev</span><br><span class="line">$ gooopen http://localhost:7001</span><br></pre></td></tr></table></figure>



<h2 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">egg-project</span><br><span class="line">├── package.json</span><br><span class="line">├── app.js (可选)</span><br><span class="line">├── agent.js (可选)</span><br><span class="line">├── app(项目开发目录)</span><br><span class="line">|   ├── router.js (用于配置 URL 路由规则)</span><br><span class="line">│   ├── controller (用于解析用户的输入，处理后返回相应的结果)</span><br><span class="line">│   |   └── home.js</span><br><span class="line">│   ├── service (用于编写业务逻辑层)</span><br><span class="line">│   |   └── user.js</span><br><span class="line">│   ├── middleware (用于编写中间件)</span><br><span class="line">│   |   └── response_time.js</span><br><span class="line">│   ├── schedule (可选)</span><br><span class="line">│   |   └── my_task.js</span><br><span class="line">│   ├── public (用于放置静态资源)</span><br><span class="line">│   |   └── reset.css</span><br><span class="line">│   ├── view (可选)</span><br><span class="line">│   |   └── home.tpl</span><br><span class="line">│   └── extend (用于框架的扩展)</span><br><span class="line">│       ├── helper.js (可选)</span><br><span class="line">│       ├── request.js (可选)</span><br><span class="line">│       ├── response.js (可选)</span><br><span class="line">│       ├── context.js (可选)</span><br><span class="line">│       ├── application.js (可选)</span><br><span class="line">│       └── agent.js (可选)</span><br><span class="line">├── config (用于编写配置文件)</span><br><span class="line">|   ├── plugin.js(用于配置需要加载的插件)</span><br><span class="line">|   ├── config.default.js</span><br><span class="line">│   ├── config.prod.js</span><br><span class="line">|   ├── config.test.js (可选)</span><br><span class="line">|   ├── config.local.js (可选)</span><br><span class="line">|   └── config.unittest.js (可选)</span><br><span class="line">└── test (用于单元测试)</span><br><span class="line">    ├── middleware</span><br><span class="line">    |   └── response_time.test.js</span><br><span class="line">    └── controller</span><br><span class="line">        └── home.test.js</span><br></pre></td></tr></table></figure>



<h2 id="MVC"><a href="#MVC" class="headerlink" title="MVC"></a>MVC</h2><p><strong>Model（模型）</strong> - 模型代表一个存取数据的对象。它也可以带有逻辑，在数据变化时更新控制器。</p>
<p><strong>View（视图）</strong> - 视图代表模型包含的数据的可视化。</p>
<p><strong>Controller（控制器）</strong> - 控制器作用于模型和视图上。它<strong>控制数据流向模型对象，并在数据变化时更新视图。它使视图与模型分离开</strong>。</p>
<h2 id="主要文件"><a href="#主要文件" class="headerlink" title="主要文件"></a>主要文件</h2><h3 id="controller"><a href="#controller" class="headerlink" title="controller"></a>controller</h3><p><code>app/controller</code>目录下实现</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Controller</span> = <span class="built_in">require</span>(<span class="string">&#x27;egg&#x27;</span>).<span class="property">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HomeController</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Controller</span> &#123;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">index</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;ctx,service&#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> service.<span class="property">home</span>.<span class="title function_">index</span>();</span><br><span class="line">    ctx.<span class="property">body</span> = res;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title class_">HomeController</span>;</span><br></pre></td></tr></table></figure>

<h3 id="service"><a href="#service" class="headerlink" title="service"></a>service</h3><p><code>app/service</code>目录下实现，在这里实现业务逻辑</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Service</span> = <span class="built_in">require</span>(<span class="string">&#x27;egg&#x27;</span>).<span class="property">Service</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HomeService</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Service</span> &#123;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">index</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="attr">ok</span>:<span class="number">1</span>&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title class_">HomeService</span>;</span><br></pre></td></tr></table></figure>

<h3 id="router"><a href="#router" class="headerlink" title="router"></a>router</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">Egg.Application</span>&#125; <span class="variable">app</span> - egg application</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function"><span class="params">app</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; router, controller &#125; = app;</span><br><span class="line">  router.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, controller.<span class="property">home</span>.<span class="property">index</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// model/user.js 创建用户模型</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function"><span class="params">app</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> mongoose = app.<span class="property">mongoose</span>;</span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">UserSchema</span> = <span class="keyword">new</span> mongoose.<span class="title class_">Schema</span>(&#123;</span><br><span class="line">    <span class="attr">username</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">      <span class="attr">unique</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">required</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">password</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">      <span class="attr">required</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">avatar</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">      <span class="attr">default</span>: <span class="string">&#x27;https://1.gravatar.com/avatar/a3e54af3cb6e157e496ae430aed4f4a3?s=96&amp;d=mm&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">createdAt</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">Date</span>,</span><br><span class="line">      <span class="attr">default</span>: <span class="title class_">Date</span>.<span class="property">now</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> mongoose.<span class="title function_">model</span>(<span class="string">&#x27;User&#x27;</span>, <span class="title class_">UserSchema</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// router.js 创建用户路由</span></span><br><span class="line"> <span class="comment">// 用户创建</span></span><br><span class="line">  router.<span class="title function_">post</span>(<span class="string">&#x27;/api/user&#x27;</span>,controller.<span class="property">user</span>.<span class="property">create</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// controller/user.js</span></span><br><span class="line"><span class="comment">//创建用户</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">create</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx, service &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">const</span> payLoad = ctx.<span class="property">request</span>.<span class="property">body</span> || &#123;&#125;;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> service.<span class="property">user</span>.<span class="title function_">create</span>(payLoad);</span><br><span class="line">    ctx.<span class="property">body</span> = &#123;res&#125;;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// service/user.js</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">create</span>(<span class="params">payload</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">        ctx</span><br><span class="line">    &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">return</span> ctx.<span class="property">model</span>.<span class="property">User</span>.<span class="title function_">create</span>(payload);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="中间件"><a href="#中间件" class="headerlink" title="中间件"></a>中间件</h2><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>在框架中，一个完整的中间件是包含了配置处理的。我们约定一个中间件是一个放置在 <code>app/middleware</code> 目录下的单独文件，它需要 exports 一个普通的 function，接受两个参数：</p>
<ul>
<li>options: 中间件的配置项，框架会将 <code>app.config[$&#123;middlewareName&#125;]</code> 传递进来。</li>
<li>app: 当前应用 Application 的实例。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自定义一个错误处理中间件</span></span><br><span class="line"><span class="comment">// app/middleware/errorHandler.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function">(<span class="params">option, app</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params">ctx, next</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">next</span>();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="comment">// 所有的异常都在app上触发一个error事件，框架会记录一条错误日志</span></span><br><span class="line">      app.<span class="title function_">emit</span>(<span class="string">&#x27;error&#x27;</span>, err, <span class="variable language_">this</span>);</span><br><span class="line">      <span class="keyword">const</span> status = err.<span class="property">status</span> || <span class="number">500</span>;</span><br><span class="line">      <span class="comment">// 生成环境下 500 错误的详细错误内容不返回给客户端，因为可能包含敏感信息</span></span><br><span class="line">      <span class="keyword">const</span> error = status === <span class="number">500</span> &amp;&amp; app.<span class="property">config</span>.<span class="property">env</span> === <span class="string">&#x27;prod&#x27;</span> ? <span class="string">&#x27;Internal Server Error&#x27;</span> : err.<span class="property">message</span></span><br><span class="line">      <span class="comment">// 从error对象上读出各个属性，设置到响应中</span></span><br><span class="line">      ctx.<span class="property">body</span> = &#123;</span><br><span class="line">        <span class="attr">code</span>: status, <span class="comment">// 服务端自身的处理逻辑错误(包含框架错误500 及 自定义业务逻辑错误533开始 ) 客户端请求参数导致的错误(4xx开始)，设置不同的状态码</span></span><br><span class="line">        <span class="attr">error</span>:error</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span>(status === <span class="number">422</span>)&#123;</span><br><span class="line">        ctx.<span class="property">body</span>.<span class="property">detail</span> = err.<span class="property">errors</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      ctx.<span class="property">status</span> = <span class="number">200</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>中间件编写完成后，我们还需要手动挂载，支持以下方式：</p>
<p>在应用中，我们可以完全通过配置来加载自定义的中间件，并决定它们的顺序。</p>
<p>如果我们需要加载上面的<code>error_handler</code> 中间件，在 <code>config.default.js</code> 中加入下面的配置就完成了中间件的开启和配置：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// add your middleware config here</span></span><br><span class="line">config.<span class="property">middleware</span> = [<span class="string">&#x27;errorHandler&#x27;</span>];</span><br></pre></td></tr></table></figure>



<p>egg-jwt  插件：<code>https://jianshu.com/p/a3d569639769</code></p>
<h2 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h2><h3 id="有了中间件，为什么还需要插件"><a href="#有了中间件，为什么还需要插件" class="headerlink" title="有了中间件，为什么还需要插件"></a>有了中间件，为什么还需要插件</h3><p>中间件加载其实是有先后顺序的，但是中间件自身却无法管理这种顺序，只能交给使用者。这样其实非常不友好，一旦顺序不对，结果可能有天壤之别。</p>
<p>中间件的定位是拦截用户请求，并在它前后做一些事情，例如：鉴权、安全检查、访问日志等等。但实际情况是，有些功能是和请求无关的，例如：定时任务、消息订阅、后台逻辑等等。</p>
<p>有些功能包含非常复杂的初始化逻辑，需要在应用启动的时候完成。这显然也不适合放到中间件中去实现</p>
<p>综上所述，我们需要一套更加强大的机制，来管理、编排那些相对独立的业务逻辑</p>
<h3 id="中间件、插件、应用的关系"><a href="#中间件、插件、应用的关系" class="headerlink" title="中间件、插件、应用的关系"></a>中间件、插件、应用的关系</h3><p>一个插件其实就是一个『迷你的应用』，和应用（app）几乎一样：</p>
<ul>
<li>它包含了 <a href="https://link.juejin.cn/?target=https://eggjs.org/zh-cn/basics/service.html">Service</a>、<a href="https://link.juejin.cn/?target=https://eggjs.org/zh-cn/basics/middleware.html">中间件</a>、<a href="https://link.juejin.cn/?target=https://eggjs.org/zh-cn/basics/config.html">配置</a>、<a href="https://link.juejin.cn/?target=https://eggjs.org/zh-cn/basics/extend.html">框架扩展</a>等等。</li>
<li>它没有独立的 <a href="https://link.juejin.cn/?target=https://eggjs.org/zh-cn/basics/router.html">Router</a> 和 <a href="https://link.juejin.cn/?target=https://eggjs.org/zh-cn/basics/controller.html">Controller</a>。</li>
<li>它没有 <code>plugin.js</code>，只能声明跟其他插件的依赖，而<strong>不能决定</strong>其他插件的开启与否。</li>
</ul>
<p>他们的关系是：</p>
<ul>
<li>应用可以直接引入 Koa 的中间件。</li>
<li>插件本身可以包含中间件。</li>
<li>多个插件可以包装为一个<a href="https://link.juejin.cn/?target=https://eggjs.org/zh-cn/advanced/framework.html">上层框架</a>。</li>
</ul>
<h3 id="框架扩展"><a href="#框架扩展" class="headerlink" title="框架扩展"></a>框架扩展</h3><p>Helper 函数用来提供一些实用的 utility 函数。</p>
<p>它的作用在于我们可以<strong>将一些常用的动作抽离在 helper.js 里面成为一个独立的函数</strong>，这样可以用 JavaScript 来写复杂的逻辑，避免逻辑分散各处。另外还有一个好处是 Helper 这样一个简单的函数，可以让我们更容易编写测试用例。</p>
<p>框架内置了一些常用的 Helper 函数。我们也可以编写自定义的 Helper 函数。</p>
<p>框架会把 <code>app/extend/helper.js</code> 中定义的对象与内置 <code>helper</code> 的 prototype 对象进行合并，在处理请求时会基于扩展后的 prototype 生成 <code>helper</code> 对象。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 例如增加一个helper.success()</span></span><br><span class="line"><span class="comment">// app/extend/helper.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">success</span>:<span class="keyword">function</span>(<span class="params">&#123;res=<span class="literal">null</span>,msg=<span class="string">&#x27;请求成功&#x27;</span>&#125;</span>) &#123;</span><br><span class="line">        <span class="comment">// this是helper对象，在其中可以调用其他的helper方法</span></span><br><span class="line">        <span class="comment">// this.ctx =&gt;context对象</span></span><br><span class="line">        <span class="comment">// this.app =&gt;application对象</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">body</span> = &#123;</span><br><span class="line">            <span class="attr">code</span>:<span class="number">200</span>,</span><br><span class="line">            <span class="attr">data</span>:res,</span><br><span class="line">            msg</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">status</span> = <span class="number">200</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// controller/user.js</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">index</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">service</span>.<span class="property">user</span>.<span class="title function_">index</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">helper</span>.<span class="title function_">success</span>(&#123;</span><br><span class="line">        res</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="一些约定"><a href="#一些约定" class="headerlink" title="一些约定"></a>一些约定</h2><h3 id="egg"><a href="#egg" class="headerlink" title="egg"></a>egg</h3><p>controller和service<br>文件名：首字母大小写随意<br>调用：此时一定是首字母小写的<br>模块名：随意<br>示例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// controller/user.js/User.js // 文件名首字母大小写随意，不影响程序正确性</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">resu</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Controller</span> &#123;&#125;; <span class="comment">// 这个类名随便写，不影响程序正确性</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = resu;</span><br><span class="line"></span><br><span class="line"><span class="comment">// router.js中调用时</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/user&#x27;</span>, controller.<span class="property">log</span>.<span class="property">index</span>); <span class="comment">// 这里一定是小写，即便文件名是User.js</span></span><br></pre></td></tr></table></figure>

<p>model<br>文件名：首字母大小写随意<br>调用：此时一定是首字母大写的<br>模块名：随意<br>示例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// model/user.js/User.js // 文件名首字母大小写随意，不影响程序正确性</span></span><br><span class="line"><span class="keyword">const</span> resu = app.<span class="property">model</span>.<span class="title function_">define</span>(<span class="string">&#x27;user&#x27;</span>, ...); <span class="comment">// 这个变量名随便写，不影响程序正确性</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// service中调用时</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">model</span>.<span class="property">User</span>.<span class="title function_">findAll</span>(); <span class="comment">// 这里一定是大写</span></span><br></pre></td></tr></table></figure>



<p>约定<br>文件名统一用小写<br>service 和 controller 调用时都是首字母小写<br>model 调用时注意首字母大写<br>变量名和类名采用首字母大写，后缀类型<br>service -&gt; UserService<br>controller -&gt; UserController<br>model -&gt; UserModel</p>
<h3 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h3><p>诸如userID之类的字段应该存储为user_id</p>
<p>get的参数从ctx.query中获取，获取到的参数的类型均为string</p>
<h2 id="项目部署"><a href="#项目部署" class="headerlink" title="项目部署"></a>项目部署</h2><h3 id="本地构建"><a href="#本地构建" class="headerlink" title="本地构建"></a>本地构建</h3><blockquote>
<p>$ cd baseDir<br>$ npm install –production<br>$ tar -zcvf ..&#x2F;release.tgz .</p>
</blockquote>
<p>构建完成后打包成 tgz 文件，部署的时候解压启动就可以了。</p>
<p>增加构建环节才能做到真正的<strong>一次构建多次部署</strong>，理论上代码没有改动的时候是不需要再次构建的，可以用原来的包进行部署</p>
<h3 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h3><p>把 <code>egg-scripts</code> 模块作为 <code>dependencies</code> 引入：</p>
<p>首先，我们需要把 <code>egg-scripts</code> 模块作为 <code>dependencies</code> 引入：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm i egg-scripts --save</span><br></pre></td></tr></table></figure>

<p>添加 <code>npm scripts</code> 到 <code>package.json</code>：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="string">&quot;egg-scripts start --daemon&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;stop&quot;</span><span class="punctuation">:</span> <span class="string">&quot;egg-scripts stop&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="启动配置项"><a href="#启动配置项" class="headerlink" title="启动配置项"></a>启动配置项</h4><p>你也可以在 <code>config.&#123;env&#125;.js</code> 中配置指定启动配置。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// config/config.default.js</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">cluster</span> = &#123;  </span><br><span class="line">    <span class="attr">listen</span>: &#123;    </span><br><span class="line">        <span class="attr">port</span>: <span class="number">7001</span>,    </span><br><span class="line">        <span class="attr">hostname</span>: <span class="string">&#x27;0.0.0.0&#x27;</span>, </span><br><span class="line">    &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>这样我们就可以通过 <code>npm start</code> 和 <code>npm stop</code> 命令启动或停止应用。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fangjun120.github.io/2022/02/08/00-00-00/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Fang Jun">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="eidolon的小窝">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/02/08/00-00-00/" class="post-title-link" itemprop="url">jQuery中的Ajax</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-02-08 00:00:00" itemprop="dateCreated datePublished" datetime="2022-02-08T00:00:00+08:00">2022-02-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-04-09 10:21:32" itemprop="dateModified" datetime="2023-04-09T10:21:32+08:00">2023-04-09</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/node/" itemprop="url" rel="index"><span itemprop="name">node</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="ajax"><a href="#ajax" class="headerlink" title="$.ajax()"></a>$.ajax()</h2><p>用于发送Ajax请求</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">     <span class="attr">type</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">     <span class="attr">url</span>: <span class="string">&#x27;http://www.example.com&#x27;</span>,</span><br><span class="line">    <span class="comment">// 若域名，协议和端口值与当前文件相同，则可以省略</span></span><br><span class="line">     <span class="attr">data</span>: &#123; <span class="attr">name</span>: <span class="string">&#x27;zhangsan&#x27;</span>, <span class="attr">age</span>: <span class="string">&#x27;20&#x27;</span> &#125;,</span><br><span class="line">     <span class="comment">//data: &#x27;name=zhangsan&amp;age=20&#x27;也可</span></span><br><span class="line">     <span class="comment">//json格式和字符串类型的参数最终都会被转化成字符串类型发送</span></span><br><span class="line">     <span class="comment">//如果服务器端要求传递json格式，</span></span><br><span class="line">     <span class="comment">// contentType :&#x27;application/json&#x27; ,并在data中传递json对象字符串</span></span><br><span class="line">     <span class="comment">// JSON.stringify(&#123;name&#125;)</span></span><br><span class="line">     <span class="attr">contentType</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span>,</span><br><span class="line">     <span class="attr">beforeSend</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123; </span><br><span class="line">         <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">         <span class="comment">// 可以取消本次请求</span></span><br><span class="line">     &#125;,</span><br><span class="line">     <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">response</span>) &#123;</span><br><span class="line">         <span class="variable language_">console</span>.<span class="title function_">log</span>(response);</span><br><span class="line">         <span class="comment">//方法内部会自动把json字符串转换为json对象</span></span><br><span class="line">     &#125;,</span><br><span class="line">     <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">xhr</span>) &#123;</span><br><span class="line">         <span class="variable language_">console</span>.<span class="title function_">log</span>(xhr);</span><br><span class="line">         <span class="comment">// xhr是一个Ajax对象</span></span><br><span class="line">     &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>发送jsonp请求</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;http://www.example.com&#x27;</span>,</span><br><span class="line">    <span class="comment">// 指定当前发送jsonp请求</span></span><br><span class="line">    <span class="attr">dataType</span>: <span class="string">&#x27;jsonp&#x27;</span>,</span><br><span class="line">    <span class="comment">// 修改callback参数名称</span></span><br><span class="line">    <span class="attr">jsonp</span>: <span class="string">&#x27;cb&#x27;</span>,</span><br><span class="line">    <span class="comment">// 指定函数名称</span></span><br><span class="line">    <span class="attr">jsonCallback</span>: <span class="string">&#x27;fnName&#x27;</span>,</span><br><span class="line">    <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">response</span>) &#123;&#125; </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="serialize方法"><a href="#serialize方法" class="headerlink" title="serialize方法"></a>serialize方法</h3><p>作用：将表单中的数据自动拼接成字符串类型的参数，类似FormData</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> params = $(<span class="string">&#x27;#form&#x27;</span>).<span class="title function_">serialize</span>();</span><br><span class="line"><span class="comment">// name=zhangsan&amp;age=30</span></span><br><span class="line"><span class="comment">// 但是这样不方便获得用户的输入值</span></span><br><span class="line"><span class="comment">// 封装函数</span></span><br><span class="line"><span class="comment">// 将表单中用户输入的内容转换为对象类型</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">serializeObject</span> (obj) &#123;</span><br><span class="line">    <span class="comment">// 处理结果对象</span></span><br><span class="line">    <span class="keyword">var</span> result = &#123;&#125;;</span><br><span class="line">    <span class="comment">// [&#123;name: &#x27;username&#x27;, value: &#x27;用户输入的内容&#x27;&#125;, &#123;name: &#x27;password&#x27;, value: &#x27;123456&#x27;&#125;]</span></span><br><span class="line">    <span class="keyword">var</span> params = obj.<span class="title function_">serializeArray</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 循环数组 将数组转换为对象类型</span></span><br><span class="line">    $.<span class="title function_">each</span>(params, <span class="keyword">function</span> (<span class="params">index, value</span>) &#123;</span><br><span class="line">        result[value.<span class="property">name</span>] = value.<span class="property">value</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 将处理的结果返回到函数外部</span></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="get、-post"><a href="#get、-post" class="headerlink" title="$.get、$.post"></a>$.get、$.post</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$.<span class="title function_">get</span>(<span class="string">&#x27;http://www.example.com&#x27;</span>, &#123;<span class="attr">name</span>: <span class="string">&#x27;zhangsan&#x27;</span>, <span class="attr">age</span>: <span class="number">30</span>&#125;, <span class="keyword">function</span> (<span class="params">response</span>) &#123;&#125;) $.<span class="title function_">post</span>(<span class="string">&#x27;http://www.example.com&#x27;</span>, &#123;<span class="attr">name</span>: <span class="string">&#x27;lisi&#x27;</span>, <span class="attr">age</span>: <span class="number">22</span>&#125;, <span class="keyword">function</span> (<span class="params">response</span>) &#123;&#125;)</span><br></pre></td></tr></table></figure>



<h2 id="Todo案例"><a href="#Todo案例" class="headerlink" title="Todo案例"></a>Todo案例</h2><h2 id="全局事件"><a href="#全局事件" class="headerlink" title="全局事件"></a>全局事件</h2><p>只要页面中有Ajax请求被发送，对应的全局事件就会被触发</p>
<p>如 当处于请求状态时，就显示“请求中”</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.<span class="title function_">ajaxStart</span>()     <span class="comment">// 当请求开始发送时触发</span></span><br><span class="line">.<span class="title function_">ajaxComplete</span>()  <span class="comment">// 当请求完成时触发</span></span><br><span class="line"></span><br><span class="line">$(<span class="variable language_">document</span>).<span class="title function_">on</span>(<span class="string">&#x27;ajaxStart&#x27;</span>,<span class="keyword">function</span>(<span class="params"></span>)&#123;&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="搭配NProgress插件可以很好的展示请求进度"><a href="#搭配NProgress插件可以很好的展示请求进度" class="headerlink" title="搭配NProgress插件可以很好的展示请求进度"></a>搭配NProgress插件可以很好的展示请求进度</h4><p>官宣：纳米级进度条，使用逼真的涓流动画来告诉用户正在发生的事情！</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--引入--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&#x27;stylesheet&#x27;</span> <span class="attr">href</span>=<span class="string">&#x27;nprogress.css&#x27;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&#x27;nprogress.js&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">NProgress</span>.<span class="title function_">start</span>();  <span class="comment">// 进度条开始运动 </span></span><br><span class="line"><span class="title class_">NProgress</span>.<span class="title function_">done</span>();   <span class="comment">// 进度条结束运动</span></span><br><span class="line"></span><br><span class="line">$(<span class="variable language_">document</span>).<span class="title function_">on</span>(<span class="string">&#x27;ajaxStart&#x27;</span>,<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">NProgress</span>.<span class="title function_">start</span>();</span><br><span class="line">&#125;)</span><br><span class="line">$(<span class="variable language_">document</span>).<span class="title function_">on</span>(<span class="string">&#x27;ajaxComplete&#x27;</span>,<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">NProgress</span>.<span class="title function_">done</span>();</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h2 id="RESTful风格的API"><a href="#RESTful风格的API" class="headerlink" title="RESTful风格的API"></a>RESTful风格的API</h2><p>RESTful API是一套关于如何设计请求地址的规范</p>
<h3 id="传统请求地址"><a href="#传统请求地址" class="headerlink" title="传统请求地址"></a>传统请求地址</h3><p>语义不明且混乱，且没有统一性</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GET http://www.example.com/getUsers         // 获取用户列表</span><br><span class="line">GET http://www.example.com/getUser?id=1     // 比如获取某一个用户的信息</span><br><span class="line">POST http://www.example.com/modifyUser      // 修改用户信息</span><br><span class="line">GET http://www.example.com/deleteUser?id=1  // 删除用户信息</span><br></pre></td></tr></table></figure>

<h3 id="RESTful-API-概述"><a href="#RESTful-API-概述" class="headerlink" title="RESTful API 概述"></a>RESTful API 概述</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET：     获取数据</span><br><span class="line">POST：    添加数据</span><br><span class="line">PUT：     更新数据</span><br><span class="line">DELETE：  删除数据</span><br><span class="line"></span><br><span class="line">get: http://www.example.com/users  //获取用户列表数据</span><br><span class="line">post: http://www.example.com/users   //创建(添加)用户数据</span><br><span class="line">get: http://www.example.com/users/1  //获取用户ID为1的用户信息</span><br><span class="line">put: http://www.example.com/users/1   //修改用户ID为1的用户信息</span><br><span class="line">delete: http://www.example.com/users/1  //删除ID为1的用户信息</span><br></pre></td></tr></table></figure>

<h2 id="XML"><a href="#XML" class="headerlink" title="XML"></a>XML</h2><p>XML 的全称是 <code>extensible markup language</code>，代表可扩展标记语言，它的作用是传输和存储数据。</p>
<p>XML的关注点在数据的内容上，HTML是用来展示数据的，关注点在数据的外观</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">students</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">student</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sid</span>&gt;</span>001<span class="tag">&lt;/<span class="name">sid</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>张三<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">student</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">student</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sid</span>&gt;</span>002<span class="tag">&lt;/<span class="name">sid</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>王二丫<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">student</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">students</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="XML-DOM"><a href="#XML-DOM" class="headerlink" title="XML DOM"></a>XML DOM</h3><p>XML DOM 即 XML 文档对象模型，是 w3c 组织定义的一套操作 XML 文档对象的API。浏览器会将 XML 文档解析成文档对象模型。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 服务器端</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/xml&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 设置响应头,告诉客户端返回的是xml数据</span></span><br><span class="line">	res.<span class="title function_">header</span>(<span class="string">&#x27;content-type&#x27;</span>, <span class="string">&#x27;text/xml&#x27;</span>);</span><br><span class="line">	res.<span class="title function_">send</span>(<span class="string">&#x27;&lt;message&gt;&lt;title&gt;消息标题&lt;/title&gt;&lt;content&gt;消息内容&lt;/content&gt;&lt;/message&gt;&#x27;</span>)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 客户端</span></span><br><span class="line">btn.<span class="property">onclick</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">    xhr.<span class="title function_">open</span>(<span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;/xml&#x27;</span>);</span><br><span class="line">    xhr.<span class="title function_">send</span>();</span><br><span class="line">    xhr.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// xhr.responseXML 获取服务器端返回的xml数据</span></span><br><span class="line">        <span class="keyword">var</span> xmlDocument = xhr.<span class="property">responseXML</span>;</span><br><span class="line">        <span class="keyword">var</span> title = xmlDocument.<span class="title function_">getElementsByTagName</span>(<span class="string">&#x27;title&#x27;</span>)[<span class="number">0</span>].<span class="property">innerHTML</span>;</span><br><span class="line">        container.<span class="property">innerHTML</span> = title;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fangjun120.github.io/2022/02/07/00-00-00/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Fang Jun">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="eidolon的小窝">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/02/07/00-00-00/" class="post-title-link" itemprop="url">Ajax</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-02-07 00:00:00" itemprop="dateCreated datePublished" datetime="2022-02-07T00:00:00+08:00">2022-02-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-04-09 10:21:32" itemprop="dateModified" datetime="2023-04-09T10:21:32+08:00">2023-04-09</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/node/" itemprop="url" rel="index"><span itemprop="name">node</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h2><h3 id="传统网站中存在的问题"><a href="#传统网站中存在的问题" class="headerlink" title="传统网站中存在的问题"></a>传统网站中存在的问题</h3><p>网速慢的情况下，页面加载时间长，用户只能等待</p>
<p>表单提交后，如果一项内容不合格，服务器端返回错误信息后将页面跳转回去，需要重新填写所有表单内容</p>
<p>页面跳转，重新加载页面，造成资源浪费，增加用户等待时间</p>
<h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>它是浏览器提供的一套方法，可以实现<strong>页面无刷新更新数据</strong>（局部更新），提高用户浏览网站应用的体验。</p>
<h3 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h3><ol>
<li><p>页面上拉加载更多数据</p>
</li>
<li><p>列表数据无刷新分页</p>
</li>
<li><p>表单项离开焦点数据验证，询问服务端当前用户是否被注册</p>
</li>
<li><p>搜索框提示文字下拉列表</p>
</li>
</ol>
<h3 id="运行环境"><a href="#运行环境" class="headerlink" title="运行环境"></a>运行环境</h3><p>Ajax 技术需要<strong>运行在网站环境中</strong>才能生效，即要以localhost域名方式打开，双击HTML文件打开则不会生效，当前课程会使用Node创建的服务器作为网站服务器。</p>
<h2 id="运行原理及实现"><a href="#运行原理及实现" class="headerlink" title="运行原理及实现"></a>运行原理及实现</h2><h3 id="运行原理"><a href="#运行原理" class="headerlink" title="运行原理"></a>运行原理</h3><p>Ajax 相当于浏览器发送请求与接收响应的代理人，在请求与响应时可以让浏览器空闲下来以继续响应用户的操作，来实现在不影响用户浏览页面的情况下，局部更新页面数据，从而提高用户体验。</p>
<p>![](E:\Tb前端资源笔记\11-16 前后端交互\14 ajax课程\笔记\images\图片1.png)</p>
<h3 id="实现步骤"><a href="#实现步骤" class="headerlink" title="实现步骤"></a>实现步骤</h3><ol>
<li><p>创建Ajax对象</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line"><span class="comment">// XML是服务端与客户端传输内容的数据格式</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>告诉Ajax请求地址及请求方式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xhr.<span class="title function_">open</span>(<span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;http://www.example.com&#x27;</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>发送请求</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xhr.<span class="title function_">send</span>();</span><br></pre></td></tr></table></figure>
</li>
<li><p>获取服务器端给客户端的响应数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 通过onload事件获取</span></span><br><span class="line"> xhr.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">     <span class="variable language_">console</span>.<span class="title function_">log</span>(xhr.<span class="property">responseText</span>);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 也可以通过onreadystatechange事件获取(过时)</span></span><br><span class="line"><span class="comment">// Ajax状态码</span></span><br><span class="line"><span class="comment">// 0：请求未初始化(还没有调用open())</span></span><br><span class="line"><span class="comment">// 1：请求已经建立，但是还没有发送(还没有调用send())</span></span><br><span class="line"><span class="comment">// 2：请求已经发送</span></span><br><span class="line"><span class="comment">// 3：请求正在处理中，通常响应中已经有部分数据可以用了</span></span><br><span class="line"><span class="comment">// 4：响应已经完成，可以获取并使用服务器的响应了</span></span><br><span class="line"><span class="comment">// xhr.readyState // 获取Ajax状态码</span></span><br><span class="line"> <span class="comment">// 当Ajax状态码发生变化时</span></span><br><span class="line"> xhr.<span class="property">onreadystatechange</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">     <span class="comment">// 判断当Ajax状态码为4时</span></span><br><span class="line">     <span class="keyword">if</span> (xhr.<span class="property">readyState</span> == <span class="number">4</span>) &#123;</span><br><span class="line">         <span class="comment">// 获取服务器端的响应数据</span></span><br><span class="line">         <span class="variable language_">console</span>.<span class="title function_">log</span>(xhr.<span class="property">responseText</span>);</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="服务器端响应的数据格式"><a href="#服务器端响应的数据格式" class="headerlink" title="服务器端响应的数据格式"></a>服务器端响应的数据格式</h3><p>在真实的项目中，服务器端大多数情况下会以 JSON 对象作为响应数据的格式。当客户端拿到响应数据时，要将 JSON 数据和 HTML 字符串进行拼接，然后将拼接的结果用BOM的方式展示在页面中。（之前是服务器端以模板引擎拼接，Ajax后需要客户端拼接）</p>
<p>在 http 请求与响应的过程中，无论是请求参数还是响应内容，最终都会被转换为对象字符串进行传输。要使用这些数据，必须先将其转换回对象类型</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">JSON</span>.<span class="title function_">parse</span>() <span class="comment">// 将 json 字符串转换为json对象</span></span><br></pre></td></tr></table></figure>

<h3 id="请求参数传递"><a href="#请求参数传递" class="headerlink" title="请求参数传递"></a>请求参数传递</h3><h4 id="使用属性名1-x3D-属性值1-amp-属性名2-x3D-属性值2的方式"><a href="#使用属性名1-x3D-属性值1-amp-属性名2-x3D-属性值2的方式" class="headerlink" title="使用属性名1&#x3D;属性值1&amp;属性名2&#x3D;属性值2的方式"></a>使用属性名1&#x3D;属性值1&amp;属性名2&#x3D;属性值2的方式</h4><h5 id="传统网站表单提交"><a href="#传统网站表单提交" class="headerlink" title="传统网站表单提交"></a>传统网站表单提交</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;get&quot;</span> <span class="attr">action</span>=<span class="string">&quot;http://www.example.com&quot;</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>/&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!-- http://www.example.com?username=zhangsan&amp;password=123456 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--请求参数会被自动拼接到对应位置--&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="Ajax要自己拼接请求参数"><a href="#Ajax要自己拼接请求参数" class="headerlink" title="Ajax要自己拼接请求参数"></a>Ajax要自己拼接请求参数</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GET请求方式</span></span><br><span class="line">xhr.<span class="title function_">open</span>(<span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;http://www.example.com?name=zs&amp;age=20&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// POST请求方式</span></span><br><span class="line"><span class="comment">// 要设置请求参数的格式类型</span></span><br><span class="line">xhr.<span class="title function_">setRequestHeader</span>(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span>) </span><br><span class="line">xhr.<span class="title function_">send</span>(<span class="string">&#x27;name=zhangsan&amp;age=20&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="使用json格式"><a href="#使用json格式" class="headerlink" title="使用json格式"></a>使用json格式</h4><p>get 请求不能提交 json 对象数据格式，传统网站的表单提交也不支持 json 对象数据格式。</p>
<p>只有post请求才能提交json对象数据格式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在请求头中指定 Content-Type 属性的值是 application/json，告诉服务器端当前请求参数的格式是 json。</span></span><br><span class="line">xhr.<span class="title function_">setRequestHeader</span>(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;application/json&#x27;</span>) </span><br><span class="line"><span class="comment">// 将json对象转换为json字符串</span></span><br><span class="line"><span class="keyword">var</span> params = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;<span class="attr">name</span>:<span class="string">&#x27;zs&#x27;</span>, <span class="attr">age</span>:<span class="number">14</span>&#125;);</span><br><span class="line">xhr.<span class="title function_">send</span>(params);</span><br></pre></td></tr></table></figure>

<h3 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h3><ol>
<li><p>网络畅通，服务器端能接收到请求，服务器端返回的结果不是预期结果。</p>
<p>可以判断服务器端返回的状态码，分别进行处理。xhr.status 获取http状态码</p>
</li>
<li><p>网络畅通，服务器端没有接收到请求，返回404状态码。</p>
</li>
</ol>
<p>​		检查请求地址是否错误。</p>
<ol start="3">
<li>网络畅通，服务器端能接收到请求，服务器端返回500状态码。</li>
</ol>
<p>​		服务器端错误，找后端程序员进行沟通。</p>
<ol start="4">
<li>网络中断，请求无法发送到服务器端。</li>
</ol>
<p>​		无法触发onload事件，会触发xhr对象下面的onerror事件，在onerror		事件处理函数中对错误进行处理。</p>
<h3 id="低版本IE浏览器的缓存问题"><a href="#低版本IE浏览器的缓存问题" class="headerlink" title="低版本IE浏览器的缓存问题"></a>低版本IE浏览器的缓存问题</h3><p>问题：在低版本的 IE 浏览器中，Ajax 请求有严重的缓存问题，即在请求地址不发生变化的情况下，只有第一次请求会真正发送到服务器端，后续的请求都会从浏览器的缓存中获取结果。即使服务器端的数据更新了，客户端依然拿到的是缓存中的旧数据。</p>
<p>解决方案：在请求地址的后面加请求参数，保证每一次请求中的请求参数的值不相同。 </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xhr.<span class="title function_">open</span>(<span class="string">&#x27;get&#x27;</span>,<span class="string">&#x27;http://www.examp.com?t=&#x27;</span> + <span class="title class_">Math</span>.<span class="title function_">random</span>());</span><br></pre></td></tr></table></figure>

<h3 id="异步编程"><a href="#异步编程" class="headerlink" title="异步编程"></a>异步编程</h3><h4 id="封装"><a href="#封装" class="headerlink" title="封装"></a>封装</h4><p>问题：发送一次请求代码过多，发送多次请求代码冗余且重复。</p>
<p>解决方案：将请求代码封装到函数中，发请求时调用函数即可。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 封装函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ajax</span> (options) &#123;</span><br><span class="line">    <span class="comment">// 存储的是默认值</span></span><br><span class="line">    <span class="keyword">var</span> defaults = &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="attr">data</span>: &#123;&#125;,</span><br><span class="line">        <span class="attr">header</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;,</span><br><span class="line">        <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用options对象中的属性覆盖defaults对象中的属性</span></span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">assign</span>(defaults, options);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建ajax对象</span></span><br><span class="line">    <span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">    <span class="comment">// 拼接请求参数的变量</span></span><br><span class="line">    <span class="keyword">var</span> params = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="comment">// 循环用户传递进来的对象格式参数</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> attr <span class="keyword">in</span> defaults.<span class="property">data</span>) &#123;</span><br><span class="line">        <span class="comment">// 将参数转换为字符串格式</span></span><br><span class="line">        params += attr + <span class="string">&#x27;=&#x27;</span> + defaults.<span class="property">data</span>[attr] + <span class="string">&#x27;&amp;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 将参数最后面的&amp;截取掉 </span></span><br><span class="line">    <span class="comment">// 将截取的结果重新赋值给params变量</span></span><br><span class="line">    params = params.<span class="title function_">substr</span>(<span class="number">0</span>, params.<span class="property">length</span> - <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 判断请求方式</span></span><br><span class="line">    <span class="keyword">if</span> (defaults.<span class="property">type</span> == <span class="string">&#x27;get&#x27;</span>) &#123;</span><br><span class="line">        defaults.<span class="property">url</span> = defaults.<span class="property">url</span> + <span class="string">&#x27;?&#x27;</span> + params;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 配置ajax对象</span></span><br><span class="line">    xhr.<span class="title function_">open</span>(defaults.<span class="property">type</span>, defaults.<span class="property">url</span>);</span><br><span class="line">    <span class="comment">// 如果请求方式为post</span></span><br><span class="line">    <span class="keyword">if</span> (defaults.<span class="property">type</span> == <span class="string">&#x27;post&#x27;</span>) &#123;</span><br><span class="line">        <span class="comment">// 用户希望的向服务器端传递的请求参数的类型</span></span><br><span class="line">        <span class="keyword">var</span> contentType = defaults.<span class="property">header</span>[<span class="string">&#x27;Content-Type&#x27;</span>]</span><br><span class="line">        <span class="comment">// 设置请求参数格式的类型</span></span><br><span class="line">        xhr.<span class="title function_">setRequestHeader</span>(<span class="string">&#x27;Content-Type&#x27;</span>, contentType);</span><br><span class="line">        <span class="comment">// 判断用户希望的请求参数格式的类型</span></span><br><span class="line">        <span class="comment">// 如果类型为json</span></span><br><span class="line">        <span class="keyword">if</span> (contentType == <span class="string">&#x27;application/json&#x27;</span>) &#123;</span><br><span class="line">            <span class="comment">// 向服务器端传递json数据格式的参数</span></span><br><span class="line">            xhr.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(defaults.<span class="property">data</span>))</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 向服务器端传递普通类型的请求参数</span></span><br><span class="line">            xhr.<span class="title function_">send</span>(params);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 发送请求</span></span><br><span class="line">        xhr.<span class="title function_">send</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 监听xhr对象下面的onload事件</span></span><br><span class="line">    <span class="comment">// 当xhr对象接收完响应数据后触发</span></span><br><span class="line">    xhr.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// xhr.getResponseHeader()</span></span><br><span class="line">        <span class="comment">// 获取响应头中的数据</span></span><br><span class="line">        <span class="keyword">var</span> contentType = xhr.<span class="title function_">getResponseHeader</span>(<span class="string">&#x27;Content-Type&#x27;</span>);</span><br><span class="line">        <span class="comment">// 服务器端返回的数据</span></span><br><span class="line">        <span class="keyword">var</span> responseText = xhr.<span class="property">responseText</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果响应类型中包含applicaition/json</span></span><br><span class="line">        <span class="keyword">if</span> (contentType.<span class="title function_">includes</span>(<span class="string">&#x27;application/json&#x27;</span>)) &#123;</span><br><span class="line">            <span class="comment">// 将json字符串转换为json对象</span></span><br><span class="line">            responseText = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(responseText)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 当http状态码等于200的时候</span></span><br><span class="line">        <span class="keyword">if</span> (xhr.<span class="property">status</span> == <span class="number">200</span>) &#123;</span><br><span class="line">            <span class="comment">// 请求成功 调用处理成功情况的函数</span></span><br><span class="line">            defaults.<span class="title function_">success</span>(responseText, xhr);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 请求失败 调用处理失败情况的函数</span></span><br><span class="line">            defaults.<span class="title function_">error</span>(responseText, xhr);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 函数调用 </span></span><br><span class="line"><span class="comment">// 传递的参数是一个对象，好处是可以清楚的看到参数值和参数名的对应</span></span><br><span class="line"><span class="title function_">ajax</span>(&#123; </span><br><span class="line">    <span class="comment">// 请求方式</span></span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">    <span class="comment">// 请求地址</span></span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;http://www.example.com&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>:&#123;</span><br><span class="line">        <span class="attr">name</span>:<span class="string">&#x27;zs&#x27;</span>,</span><br><span class="line">        <span class="attr">age</span>:<span class="number">20</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 请求成功</span></span><br><span class="line">    <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">data</span>) &#123; </span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="客户端模板引擎"><a href="#客户端模板引擎" class="headerlink" title="客户端模板引擎"></a>客户端模板引擎</h2><h3 id="使用步骤"><a href="#使用步骤" class="headerlink" title="使用步骤"></a>使用步骤</h3><ol>
<li>下载 art-template 模板引擎库文件并在 HTML 页面中引入库文件</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./js/template-web.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>准备 art-template 模板</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 客户端模板引擎不能读取文件，因此只能是一个代码片段</span><br><span class="line">// 用script标签，用id作为标识</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">id</span>=<span class="string">&quot;tpl&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/html&quot;</span>&gt;</span><span class="language-handlebars"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><span class="template-variable">&#123;&#123; <span class="name">username</span> &#125;&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"></span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>告诉模板引擎将哪一个模板和哪个数据进行拼接</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 第一个参数是模板id，第二个参数是要在模板中展示的数据</span></span><br><span class="line"><span class="comment">// 返回值是拼接好的html字符串</span></span><br><span class="line"><span class="keyword">var</span> html = <span class="title function_">template</span>(<span class="string">&#x27;tpl&#x27;</span>, &#123;<span class="attr">username</span>: <span class="string">&#x27;zhangsan&#x27;</span>&#125;);</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>将拼接好的html字符串添加到页面中</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;container&#x27;</span>).<span class="property">innerHTML</span> = html;</span><br></pre></td></tr></table></figure>

<h2 id="Ajax案例：验证邮箱唯一性"><a href="#Ajax案例：验证邮箱唯一性" class="headerlink" title="Ajax案例：验证邮箱唯一性"></a>Ajax案例：验证邮箱唯一性</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/js/ajax.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 获取页面中的元素</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> emailInp = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;email&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> info = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;info&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 当文本框离开焦点以后</span></span></span><br><span class="line"><span class="language-javascript">    emailInp.<span class="property">onblur</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 获取用户输入的邮箱地址</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> email = <span class="variable language_">this</span>.<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 验证邮箱地址的正则表达式</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> reg = <span class="regexp">/^[A-Za-z\d]+([-_.][A-Za-z\d]+)*@([A-Za-z\d]+[-.])+[A-Za-z\d]&#123;2,4&#125;$/</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 如果用户输入的邮箱地址不符合规则</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (!reg.<span class="title function_">test</span>(email)) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 给出用户提示</span></span></span><br><span class="line"><span class="language-javascript">            info.<span class="property">innerHTML</span> = <span class="string">&#x27;请输入符合规则的邮箱地址&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 让提示信息显示为错误提示信息的样式</span></span></span><br><span class="line"><span class="language-javascript">            info.<span class="property">className</span> = <span class="string">&#x27;bg-danger&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 阻止程序向下执行</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 向服务器端发送请求</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">ajax</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">type</span>: <span class="string">&#x27;get&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">url</span>: <span class="string">&#x27;http://localhost:3000/verifyEmailAdress&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">email</span>: email</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 在success中改变HTML结构，实现局部刷新</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">result</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(result);</span></span><br><span class="line"><span class="language-javascript">                info.<span class="property">innerHTML</span> = result.<span class="property">message</span>;</span></span><br><span class="line"><span class="language-javascript">                info.<span class="property">className</span> = <span class="string">&#x27;bg-success&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">result</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(result)</span></span><br><span class="line"><span class="language-javascript">                info.<span class="property">innerHTML</span> = result.<span class="property">message</span>;</span></span><br><span class="line"><span class="language-javascript">                info.<span class="property">className</span> = <span class="string">&#x27;bg-danger&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="FormData"><a href="#FormData" class="headerlink" title="FormData"></a>FormData</h2><p>H5提供，当参数较多时，参数值的获取和参数的拼接都很繁琐，且普通Ajax不能传递二进制文件，如图片</p>
<h3 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h3><ol>
<li><p>模拟HTML表单，相当于将HTML表单映射成表单对象，自动将表单对象中的数据拼接成请求参数的格式。</p>
</li>
<li><p>异步上传二进制文件</p>
</li>
</ol>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><ol>
<li>准备 HTML 表单</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--name属性将作为请求参数的属性名称传递给服务器端--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;form&quot;</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> /&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> /&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>将 HTML 表单转化为 formData 对象</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> form = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;form&#x27;</span>); </span><br><span class="line"><span class="keyword">var</span> formData = <span class="keyword">new</span> <span class="title class_">FormData</span>(form);</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>提交表单对象</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xhr.<span class="title function_">send</span>(formData);</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong></p>
<ol>
<li><p>Formdata 对象不能用于 get 请求，因为对象需要被传递到 send 方法中，而 get 请求方式的请求参数只能放在请求地址的后面。</p>
</li>
<li><p>服务器端 bodyParser 模块不能解析 formData 对象表单数据，我们需<strong>要使用 formidable 模块进行解析</strong>(见博客案例)。</p>
</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;form&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">id</span>=<span class="string">&quot;btn&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 获取按钮</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> btn = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;btn&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 获取表单</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> form = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;form&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 为按钮添加点击事件</span></span></span><br><span class="line"><span class="language-javascript">    btn.<span class="property">onclick</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 将普通的html表单转换为表单对象</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> formData = <span class="keyword">new</span> <span class="title class_">FormData</span>(form);</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 创建ajax对象</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 对ajax对象进行配置</span></span></span><br><span class="line"><span class="language-javascript">        xhr.<span class="title function_">open</span>(<span class="string">&#x27;post&#x27;</span>, <span class="string">&#x27;http://localhost:3000/formData&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 发送ajax请求</span></span></span><br><span class="line"><span class="language-javascript">        xhr.<span class="title function_">send</span>(formData);</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 监听xhr对象下面的onload事件</span></span></span><br><span class="line"><span class="language-javascript">        xhr.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 对象http状态码进行判断</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (xhr.<span class="property">status</span> == <span class="number">200</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(xhr.<span class="property">responseText</span>);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="实例方法"><a href="#实例方法" class="headerlink" title="实例方法"></a>实例方法</h3><ol>
<li>获取表单对象中属性的值</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">formData.<span class="title function_">get</span>(<span class="string">&#x27;key&#x27;</span>);</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>设置表单对象中属性的值，有则替换，没有则创建</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">formData.<span class="title function_">set</span>(<span class="string">&#x27;key&#x27;</span>, <span class="string">&#x27;value&#x27;</span>);</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>删除表单对象中属性的值</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">formData.<span class="title function_">delete</span>(<span class="string">&#x27;key&#x27;</span>);</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>向表单对象中<strong>追加</strong>属性值</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">formData.<span class="title function_">append</span>(<span class="string">&#x27;key&#x27;</span>, <span class="string">&#x27;value&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：set 方法与 append 方法的区别是，在属性名已存在的情况下，set 会覆盖已有键名的值，append会保留两个值。</p>
<h3 id="二进制文件上传"><a href="#二进制文件上传" class="headerlink" title="二进制文件上传"></a>二进制文件上传</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">id</span>=<span class="string">&quot;file&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 客户端</span></span><br><span class="line"><span class="keyword">var</span> file = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;file&#x27;</span>)</span><br><span class="line"><span class="comment">// 当用户选择文件的时候</span></span><br><span class="line">file.<span class="property">onchange</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 创建空表单对象</span></span><br><span class="line">    <span class="keyword">var</span> formData = <span class="keyword">new</span> <span class="title class_">FormData</span>();</span><br><span class="line">    <span class="comment">// 将用户选择的二进制文件追加到表单对象中</span></span><br><span class="line">    formData.<span class="title function_">append</span>(<span class="string">&#x27;attrName&#x27;</span>, <span class="variable language_">this</span>.<span class="property">files</span>[<span class="number">0</span>]);</span><br><span class="line">    <span class="comment">// 配置ajax对象，请求方式必须为post</span></span><br><span class="line">    xhr.<span class="title function_">open</span>(<span class="string">&#x27;post&#x27;</span>, <span class="string">&#x27;www.example.com&#x27;</span>);</span><br><span class="line">    xhr.<span class="title function_">send</span>(formData);</span><br><span class="line">     <span class="comment">// 监听服务器端响应给客户端的数据</span></span><br><span class="line">    xhr.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 如果服务器端返回的http状态码为200</span></span><br><span class="line">        <span class="comment">// 说明请求是成功的</span></span><br><span class="line">        <span class="keyword">if</span> (xhr.<span class="property">status</span> == <span class="number">200</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 服务器端接收文件</span></span><br><span class="line"><span class="comment">// 实现文件上传的路由</span></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/upload&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="comment">// 创建formidable表单解析对象</span></span><br><span class="line">	<span class="keyword">const</span> form = <span class="keyword">new</span> formidable.<span class="title class_">IncomingForm</span>();</span><br><span class="line">	<span class="comment">// 设置客户端上传文件的存储路径</span></span><br><span class="line">	form.<span class="property">uploadDir</span> = path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;public&#x27;</span>, <span class="string">&#x27;uploads&#x27;</span>);</span><br><span class="line">	<span class="comment">// 保留上传文件的后缀名字</span></span><br><span class="line">	form.<span class="property">keepExtensions</span> = <span class="literal">true</span>;</span><br><span class="line">	<span class="comment">// 解析客户端传递过来的FormData对象</span></span><br><span class="line">	form.<span class="title function_">parse</span>(req, <span class="function">(<span class="params">err, fields, files</span>) =&gt;</span> &#123;</span><br><span class="line">		<span class="comment">// 将客户端传递过来的文件地址响应到客户端</span></span><br><span class="line">		res.<span class="title function_">send</span>(&#123;</span><br><span class="line">			<span class="attr">path</span>: files.<span class="property">attrName</span>.<span class="property">path</span>.<span class="title function_">split</span>(<span class="string">&#x27;public&#x27;</span>)[<span class="number">1</span>]</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="上传进度条展示"><a href="#上传进度条展示" class="headerlink" title="上传进度条展示"></a>上传进度条展示</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;progress&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;progress-bar&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 0%;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;bar&quot;</span>&gt;</span>0%<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// 当用户选择文件的时候</span></span></span><br><span class="line"><span class="language-javascript">file.<span class="property">onchange</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 文件上传过程中持续触发onprogress事件</span></span></span><br><span class="line"><span class="language-javascript">    xhr.<span class="property">upload</span>.<span class="property">onprogress</span> = <span class="keyword">function</span> (<span class="params">ev</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 当前上传文件大小/文件总大小 再将结果转换为百分数</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 将结果赋值给进度条的宽度属性 </span></span></span><br><span class="line"><span class="language-javascript">        bar.<span class="property">style</span>.<span class="property">width</span> = (ev.<span class="property">loaded</span>/ev.<span class="property">total</span>) * <span class="number">100</span> + <span class="string">&#x27;%&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 将百分比显示在进度条中</span></span></span><br><span class="line"><span class="language-javascript">        bar.<span class="property">innerHTML</span> = result;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="上传图片即时预览"><a href="#上传图片即时预览" class="headerlink" title="上传图片即时预览"></a>上传图片即时预览</h4><p>在我们将图片上传到服务器端以后，服务器端通常都会将图片地址做为响应数据传递到客户端，客户端可以从响应数据中获取图片地址，然后将图片再显示在页面中。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">xhr.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(xhr.<span class="property">status</span> == <span class="number">200</span>)&#123;</span><br><span class="line">        <span class="keyword">var</span> result = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(xhr.<span class="property">responseText</span>);</span><br><span class="line">        <span class="comment">// 动态创建img标签，若在HTML中直接写一个img标签会让用户看			到上传过程</span></span><br><span class="line">        <span class="keyword">var</span> img = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;img&#x27;</span>);</span><br><span class="line">        img.<span class="property">src</span> = result.<span class="property">src</span>;</span><br><span class="line">        <span class="comment">// 图片加载完成后触发onload事件</span></span><br><span class="line">        img.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            element.<span class="title function_">appendChild</span>(<span class="variable language_">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="同源政策"><a href="#同源政策" class="headerlink" title="同源政策"></a>同源政策</h2><h3 id="Ajax请求限制"><a href="#Ajax请求限制" class="headerlink" title="Ajax请求限制"></a>Ajax请求限制</h3><p>Ajax 只能向自己的服务器发送请求。A网站中的 HTML 文件只能向A网站服务器中发送 Ajax 请求，不能向 B 网站发送 Ajax请求。但在实际开发中确实有这样的需求，比如要获取天气信息，就要使用国家气象局提供的API</p>
<h3 id="什么是同源"><a href="#什么是同源" class="headerlink" title="什么是同源"></a>什么是同源</h3><p>如果两个页面拥有<strong>相同的协议、域名和端口</strong>，那么这两个页面就属于同一个源，其中只要有一个不相同，就是不同源。</p>
<p><a target="_blank" rel="noopener" href="http://www.example.com/dir/page.html">http://www.example.com/dir/page.html</a></p>
<p><a target="_blank" rel="noopener" href="http://www.example.com/dir2/other.html%EF%BC%9A%E5%90%8C%E6%BA%90">http://www.example.com/dir2/other.html：同源</a></p>
<p><a target="_blank" rel="noopener" href="http://example.com/dir/other.html%EF%BC%9A%E4%B8%8D%E5%90%8C%E6%BA%90%EF%BC%88%E5%9F%9F%E5%90%8D%E4%B8%8D%E5%90%8C%EF%BC%89">http://example.com/dir/other.html：不同源（域名不同）</a></p>
<p><a target="_blank" rel="noopener" href="http://v2.www.example.com/dir/other.html%EF%BC%9A%E4%B8%8D%E5%90%8C%E6%BA%90%EF%BC%88%E5%9F%9F%E5%90%8D%E4%B8%8D%E5%90%8C%EF%BC%89">http://v2.www.example.com/dir/other.html：不同源（域名不同）</a></p>
<p><a target="_blank" rel="noopener" href="http://www.example.com:81/dir/other.html%EF%BC%9A%E4%B8%8D%E5%90%8C%E6%BA%90%EF%BC%88%E7%AB%AF%E5%8F%A3%E4%B8%8D%E5%90%8C%EF%BC%89">http://www.example.com:81/dir/other.html：不同源（端口不同）</a></p>
<p><a target="_blank" rel="noopener" href="https://www.example.com/dir/page.html%EF%BC%9A%E4%B8%8D%E5%90%8C%E6%BA%90%EF%BC%88%E5%8D%8F%E8%AE%AE%E4%B8%8D%E5%90%8C%EF%BC%89">https://www.example.com/dir/page.html：不同源（协议不同）</a></p>
<h3 id="同源政策-1"><a href="#同源政策-1" class="headerlink" title="同源政策"></a>同源政策</h3><p>同源政策是为了保证用户信息的安全，防止恶意的网站窃取数据。最初的同源政策是指 A 网站在客户端设置的 Cookie(包含隐私信息)，B网站是不能访问的。</p>
<p>随着互联网的发展，同源政策也越来越严格，在不同源的情况下，其中有一项规定就是无法向非同源地址发送Ajax 请求，如果请求，浏览器就会报错。</p>
<h3 id="使用JSONP解决同源限制问题"><a href="#使用JSONP解决同源限制问题" class="headerlink" title="使用JSONP解决同源限制问题"></a>使用JSONP解决同源限制问题</h3><p>jsonp(json with padding)，不属于 Ajax 请求，但它可以模拟 Ajax 请求。</p>
<ol>
<li><p>将不同源的服务器端请求地址写在 script 标签的 src 属性中</p>
<ul>
<li><p>因为该属性不受同源政策的影响</p>
</li>
<li><p>script标签不止可以引入js文件，请求地址可以是任意形式，但是其<strong>返回的结果必须是规范的js代码</strong>，因为会将返回的结果以js代码方式执行</p>
</li>
<li><pre><code class="html">&lt;script src=&quot;www.example.com&quot;&gt;&lt;/script&gt;
 
&lt;script src=“https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js&quot;&gt;&lt;/script&gt;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">2. 服务器端响应数据必须是一个函数的调用，真正要发送给客户端的数据需要作为函数调用的参数。</span><br><span class="line"></span><br><span class="line">   - ```js</span><br><span class="line">      // 字符串包裹函数调用的代码</span><br><span class="line">      const data = &#x27;fn(&#123;name: &quot;张三&quot;, age: &quot;20&quot;&#125;)&#x27;;</span><br><span class="line">      res.send(data);</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
</li>
<li><p>在客户端全局作用域下定义函数 fn，写在script标签上面</p>
<ul>
<li><pre><code class="js">  function fn (data) &#123; &#125;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">4. 在 fn 函数内部对服务器端返回的数据进行处理</span><br><span class="line"></span><br><span class="line">   - ```js</span><br><span class="line">      function fn (data) &#123; console.log(data); &#125;</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
</li>
</ol>
<h4 id="JSONP代码优化"><a href="#JSONP代码优化" class="headerlink" title="JSONP代码优化"></a>JSONP代码优化</h4><ol>
<li><p>客户端需要将函数名称传递到服务器端。</p>
</li>
<li><p>将 script 请求的发送变成动态请求。</p>
</li>
<li><p>封装 jsonp 函数，方便请求发送。</p>
</li>
<li><p>服务器端代码优化之 res.jsonp 方法。</p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">jsonp</span> (options) &#123;</span><br><span class="line">    <span class="comment">// 动态创建script标签</span></span><br><span class="line">    <span class="keyword">var</span> script = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;script&#x27;</span>);</span><br><span class="line">    <span class="comment">// 拼接字符串的变量</span></span><br><span class="line">    <span class="keyword">var</span> params = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> attr <span class="keyword">in</span> options.<span class="property">data</span>) &#123;</span><br><span class="line">        params += <span class="string">&#x27;&amp;&#x27;</span> + attr + <span class="string">&#x27;=&#x27;</span> + options.<span class="property">data</span>[attr];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// myJsonp0124741</span></span><br><span class="line">    <span class="keyword">var</span> fnName = <span class="string">&#x27;myJsonp&#x27;</span> + <span class="title class_">Math</span>.<span class="title function_">random</span>().<span class="title function_">toString</span>().<span class="title function_">replace</span>(<span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    <span class="comment">// 它已经不是一个全局函数了</span></span><br><span class="line">    <span class="comment">// 我们要想办法将它变成全局函数</span></span><br><span class="line">    <span class="variable language_">window</span>[fnName] = options.<span class="property">success</span>;</span><br><span class="line">    <span class="comment">// 为script标签添加src属性</span></span><br><span class="line">    script.<span class="property">src</span> = options.<span class="property">url</span> + <span class="string">&#x27;?callback=&#x27;</span> + fnName + params;</span><br><span class="line">    <span class="comment">// 将script标签追加到页面中</span></span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(script);</span><br><span class="line">    <span class="comment">// 为script标签添加onload事件</span></span><br><span class="line">    script.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">removeChild</span>(script);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 客户端</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/better&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="comment">// 接收客户端传递过来的函数的名称</span></span><br><span class="line">	<span class="comment">//const fnName = req.query.callback;</span></span><br><span class="line">	<span class="comment">// 将函数名称对应的函数调用代码返回给客户端</span></span><br><span class="line">	<span class="comment">//const data = JSON.stringify(&#123;name: &quot;张三&quot;&#125;);</span></span><br><span class="line">	<span class="comment">//const result = fnName + &#x27;(&#x27;+ data +&#x27;)&#x27;;</span></span><br><span class="line">	<span class="comment">// setTimeout(() =&gt; &#123;</span></span><br><span class="line">	<span class="comment">// 	res.send(result);</span></span><br><span class="line">	<span class="comment">// &#125;, 1000)</span></span><br><span class="line">	res.<span class="title function_">jsonp</span>(&#123;<span class="attr">name</span>: <span class="string">&#x27;lisi&#x27;</span>, <span class="attr">age</span>: <span class="number">20</span>&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="用CORS解决同源限制问题"><a href="#用CORS解决同源限制问题" class="headerlink" title="用CORS解决同源限制问题"></a>用CORS解决同源限制问题</h3><p>CORS(Cross-origin resource sharing)，即跨域资源共享、非同源数据共享，它允许浏览器向跨域服务器发送 Ajax 请求，克服了 Ajax 只能同源使用的限制。</p>
<p>与jsonp绕过同源限制，发送的也不是Ajax请求不同，CORS允许浏览器向跨域服务器发送Ajax请求，只要服务器端允许跨域访问就能访问。客户端保持原有的Ajax代码不变，服务器端配置即可</p>
<p>![](E:\Tb前端资源笔记\11-16 前后端交互\14 ajax课程\笔记\images\图片3.png)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 服务器端的简单设置 </span></span><br><span class="line"><span class="comment">// 真实项目中路由有很多，用use拦截所有请求</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="comment">// 1.允许哪些客户端访问我</span></span><br><span class="line">	<span class="comment">// * 代表允许所有的客户端访问我</span></span><br><span class="line">	<span class="comment">// 注意：如果跨域请求中涉及到cookie信息传递，值不可以为*号 比如是具体的域名信息</span></span><br><span class="line">	res.<span class="title function_">header</span>(<span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>, <span class="string">&#x27;http://localhost:3000&#x27;</span>)</span><br><span class="line">	<span class="comment">// 2.允许客户端使用哪些请求方法访问我</span></span><br><span class="line">	res.<span class="title function_">header</span>(<span class="string">&#x27;Access-Control-Allow-Methods&#x27;</span>, <span class="string">&#x27;get,post&#x27;</span>)</span><br><span class="line">	<span class="comment">// 允许客户端发送跨域请求时携带cookie信息</span></span><br><span class="line">	res.<span class="title function_">header</span>(<span class="string">&#x27;Access-Control-Allow-Credentials&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line">    <span class="title function_">next</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="访问非同源数据服务器端解决方案"><a href="#访问非同源数据服务器端解决方案" class="headerlink" title="访问非同源数据服务器端解决方案"></a>访问非同源数据服务器端解决方案</h3><p>同源政策是浏览器给予Ajax技术的限制，服务器端是不存在同源政策限制。</p>
<p>![](E:\Tb前端资源笔记\11-16 前后端交互\14 ajax课程\笔记\images\图片4.png)</p>
<p>因此当A客户端想要获取B服务器端的数据，可以请求A服务端去获取，由A服务器端再返回给A客户端</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// A客户端</span></span><br><span class="line">btn.<span class="property">onclick</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 向A服务器端发送请求</span></span><br><span class="line">    <span class="title function_">ajax</span>(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;http://localhost:3000/server&#x27;</span>,</span><br><span class="line">        <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// A服务器端</span></span><br><span class="line"><span class="comment">// 向其他服务器端请求数据的模块，需要下载 npm install request</span></span><br><span class="line"><span class="keyword">const</span> request = <span class="built_in">require</span>(<span class="string">&#x27;request&#x27;</span>);</span><br><span class="line"><span class="comment">// A服务器端向B服务器端请求</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/server&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="title function_">request</span>(<span class="string">&#x27;http://localhost:3001/cross&#x27;</span>, <span class="function">(<span class="params">err, response, body</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// response是响应信息</span></span><br><span class="line">        <span class="comment">// body是B服务器端的响应数据</span></span><br><span class="line">		res.<span class="title function_">send</span>(body);</span><br><span class="line">        <span class="comment">// 将body返回给A客户端</span></span><br><span class="line">	&#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="跨域请求中携带cookie的问题"><a href="#跨域请求中携带cookie的问题" class="headerlink" title="跨域请求中携带cookie的问题"></a>跨域请求中携带cookie的问题</h3><p>客户端和服务器端的沟通是无状态的，即服务器端不管客户端是谁，只关注响应，两者之间的沟通没有记忆性，多次响应之后仍是陌生人。</p>
<p>cookie是用于客户端与服务器端身份识别的一种技术。当客户端第一次访问服务器端，服务器端会响应给客户端一个cookie，起到身份证的作用。当客户端再次访问服务器端，cookie也会被自动发送。服务器端根据cookie就可以辨别客户端身份</p>
<p>在使用Ajax技术发送跨域请求时，默认情况下不会在请求中携带cookie信息。</p>
<h5 id="withCredentials属性"><a href="#withCredentials属性" class="headerlink" title="withCredentials属性"></a>withCredentials属性</h5><p>withCredentials：指定在涉及到跨域请求时，是否携带cookie信息，默认值为false</p>
<p>Access-Control-Allow-Credentials：true 允许客户端发送请求时携带cookie</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 客户端</span></span><br><span class="line"><span class="comment">// 创建ajax对象</span></span><br><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line"><span class="comment">// 对ajax对象进行配置</span></span><br><span class="line">xhr.<span class="title function_">open</span>(<span class="string">&#x27;post&#x27;</span>, <span class="string">&#x27;http://localhost:3001/login&#x27;</span>);</span><br><span class="line"><span class="comment">// 当发送跨域请求时，携带cookie信息</span></span><br><span class="line">xhr.<span class="property">withCredentials</span> = <span class="literal">true</span>;</span><br><span class="line"><span class="comment">// 发送请求并传递请求参数</span></span><br><span class="line">xhr.<span class="title function_">send</span>();</span><br><span class="line"><span class="comment">// 监听服务器端给予的响应内容</span></span><br><span class="line">xhr.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(xhr.<span class="property">responseText</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 服务器端</span></span><br><span class="line"><span class="comment">// 拦截所有请求</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="comment">// 1.允许哪些客户端访问我</span></span><br><span class="line">	<span class="comment">// * 代表允许所有的客户端访问我</span></span><br><span class="line">	<span class="comment">// 注意：如果跨域请求中涉及到cookie信息传递，值不可以为*号 比如是具体的域名信息</span></span><br><span class="line">	res.<span class="title function_">header</span>(<span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>, <span class="string">&#x27;http://localhost:3000&#x27;</span>)</span><br><span class="line">	<span class="comment">// 2.允许客户端使用哪些请求方法访问我</span></span><br><span class="line">	res.<span class="title function_">header</span>(<span class="string">&#x27;Access-Control-Allow-Methods&#x27;</span>, <span class="string">&#x27;get,post&#x27;</span>)</span><br><span class="line">	<span class="comment">// 允许客户端发送跨域请求时携带cookie信息</span></span><br><span class="line">	res.<span class="title function_">header</span>(<span class="string">&#x27;Access-Control-Allow-Credentials&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line">	<span class="title function_">next</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fangjun120.github.io/2022/02/06/00-00-00/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Fang Jun">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="eidolon的小窝">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/02/06/00-00-00/" class="post-title-link" itemprop="url">博客案例</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-02-06 00:00:00" itemprop="dateCreated datePublished" datetime="2022-02-06T00:00:00+08:00">2022-02-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-04-09 10:21:29" itemprop="dateModified" datetime="2023-04-09T10:21:29+08:00">2023-04-09</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/node/" itemprop="url" rel="index"><span itemprop="name">node</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="项目环境搭建"><a href="#项目环境搭建" class="headerlink" title="项目环境搭建"></a>项目环境搭建</h2><h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><ol>
<li><p>建立项目所需文件夹</p>
<ul>
<li><p>public 静态资源</p>
</li>
<li><p>model 数据库操作</p>
</li>
<li><p>route 路由</p>
</li>
<li><p>views 模板</p>
</li>
</ul>
</li>
<li><p>初始化项目描述文件</p>
<ul>
<li>npm init -y</li>
</ul>
</li>
<li><p>下载项目所需第三方模块</p>
<ul>
<li>npm install express mongoose art-template express-art-template</li>
</ul>
</li>
<li><p>创建网站服务器</p>
</li>
<li><p>构建模块化路由</p>
</li>
<li><p>构建博客管理页面模板</p>
<p>在构建模板时，需要将html文件的后缀改为.art。展示在浏览器时，文件内原本使用link标签引用的资源的相对路径是相对于地址栏中的请求路径的</p>
<p>注意<code>localhost/admin/login</code>这个路径，login被浏览器认为是文件，默认不写后缀，因此<code>localhost/admin</code>才是路径</p>
<p>要想外链资源能够生效，就要确保该路径下确实有该资源文件。否则渲染出来的页面只有html模板，css和js会失效</p>
<p>可以使用绝对路径来避免这个问题，将html（art）中所有外链资源的href最前面加<code>/</code>，代表使用设置的模板根目录</p>
</li>
<li><p>使用模板引擎中的子模板抽离公共模块</p>
</li>
</ol>
<h2 id="项目功能实现"><a href="#项目功能实现" class="headerlink" title="项目功能实现"></a>项目功能实现</h2><h3 id="登录功能"><a href="#登录功能" class="headerlink" title="登录功能"></a>登录功能</h3><p>1.创建用户集合，初始化用户</p>
<ol>
<li><p>连接数据库</p>
</li>
<li><p>创建用户集合</p>
</li>
<li><p>初始化用户</p>
</li>
</ol>
<p>2.在<code>login.art</code>为登录表单设置请求地址、请求方式以及表单项name属性</p>
<p>3.当用户点击登录按钮时，客户端验证用户是否填写了登录表单</p>
<p>4.如果其中一项没有输入，阻止表单提交</p>
<p>5.服务器端接收请求参数，验证用户是否填写了登录表单（防止客户端禁用了js导致客户端验证失效，因此服务器端再验证一次）</p>
<p>6.如果其中一项没有输入，为客户端做出响应，阻止程序向下执行</p>
<p>7.根据邮箱地址查询用户信息</p>
<p>8.如果用户不存在，为客户端做出响应，阻止程序向下执行</p>
<p>9.如果用户存在，将用户名和密码进行比对</p>
<p>10.比对成功，用户登录成功</p>
<p>11.比对失败，用户登录失败</p>
<p>12.保存登录状态</p>
<p>13.密码加密处理</p>
<h2 id="包含的知识点"><a href="#包含的知识点" class="headerlink" title="包含的知识点"></a>包含的知识点</h2><h3 id="开发环境和生产环境"><a href="#开发环境和生产环境" class="headerlink" title="开发环境和生产环境"></a>开发环境和生产环境</h3><p>环境，就是指项目运行的地方，当项目处于开发阶段，项目运行在开发人员的电脑上，项目所处的环境就是开发环境。当项目开发完成以后，要将项目放到真实的网站服务器电脑中运行，项目所处的环境就是生产环境。</p>
<p>因为在不同的环境中，项目的配置是不一样的，需要在项目代码中判断当前项目运行的环境，根据不同的环境应用不同的项目配置。</p>
<h4 id="如何区分"><a href="#如何区分" class="headerlink" title="如何区分"></a>如何区分</h4><p>通过电脑操作系统中的系统环境变量区分当前是开发环境还是生产环境。</p>
<p>![](E:\Tb前端资源笔记\11-16 前后端交互\11-13node+express\笔记\images\图片12.png)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> == <span class="string">&#x27;development&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// 开发环境</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 生产环境</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="第三方模块config"><a href="#第三方模块config" class="headerlink" title="第三方模块config"></a>第三方模块config</h3><p>作用：允许开发人员将不同运行环境下的应用配置信息抽离到单独的文件中，模块内部自动判断当前应用的运行环境，并读取对应的配置信息，极大提供应用配置信息的维护成本，避免了当运行环境重复的多次切换时，手动到项目代码中修改配置信息</p>
<p><strong>使用步骤</strong></p>
<ol>
<li><p>使用npm install config命令下载模块</p>
</li>
<li><p>在项目的根目录下新建config文件夹</p>
</li>
<li><p>在config文件夹下面新建default.json、development.json、production.json文件</p>
</li>
<li><p>在项目中通过require方法，将模块进行导入</p>
</li>
<li><p>使用模块内部提供的get方法获取配置信息</p>
</li>
</ol>
<p><strong>将敏感配置信息存储在环境变量中</strong></p>
<ol>
<li><p>在config文件夹中建立custom-environment-variables.json文件</p>
</li>
<li><p>配置项属性的值填写系统环境变量的名字</p>
</li>
<li><p>项目运行时config模块查找系统环境变量，并读取其值作为当前配置项属于的值</p>
</li>
</ol>
<p>![](E:\Tb前端资源笔记\11-16 前后端交互\11-13node+express\笔记\images\图片13.png)</p>
<h3 id="密码加密-bcrypt"><a href="#密码加密-bcrypt" class="headerlink" title="密码加密 bcrypt"></a>密码加密 bcrypt</h3><p>哈希加密是单程加密方式：1234 &#x3D;&gt; abcd</p>
<p>在加密的密码中加入随机字符串可以增加密码被破解的难度。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入bcrypt模块</span></span><br><span class="line"><span class="keyword">const</span> bcrypt = <span class="built_in">require</span>(<span class="string">&#x27;bcrypt&#x27;</span>);</span><br><span class="line"><span class="comment">// 生成随机字符串 gen =&gt; generate 生成 salt 盐</span></span><br><span class="line"><span class="keyword">let</span> salt = <span class="keyword">await</span> bcrypt.<span class="title function_">genSalt</span>(<span class="number">10</span>);</span><br><span class="line"><span class="comment">// 使用随机字符串对密码进行加密</span></span><br><span class="line"><span class="keyword">let</span> pass = <span class="keyword">await</span> bcrypt.<span class="title function_">hash</span>(<span class="string">&#x27;明文密码&#x27;</span>, salt);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 密码比对</span></span><br><span class="line"><span class="keyword">let</span> isEqual = <span class="keyword">await</span> bcrypt.<span class="title function_">compare</span>(<span class="string">&#x27;明文密码&#x27;</span>, <span class="string">&#x27;加密密码&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>bcrypt依赖的其他环境</p>
<ol>
<li><p>python 2.x</p>
</li>
<li><p>node-gyp</p>
<pre><code>   npm install -g node-gyp
</code></pre>
</li>
<li><p>windows-build-tools</p>
<pre><code>    npm install --global --production windows-build-tools
</code></pre>
</li>
</ol>
<h3 id="cookie和session"><a href="#cookie和session" class="headerlink" title="cookie和session"></a>cookie和session</h3><h4 id="cookie："><a href="#cookie：" class="headerlink" title="cookie："></a>cookie：</h4><p>浏览器在电脑硬盘中开辟的一块空间，主要供服务器端存储数据。</p>
<p>cookie中的数据是以域名的形式进行区分的。</p>
<p>cookie中的数据是有过期时间的，超过时间数据会被浏览器自动删除。</p>
<p>cookie中的数据会随着请求被自动发送到服务器端。</p>
<h4 id="session："><a href="#session：" class="headerlink" title="session："></a>session：</h4><p>实际上就是一个对象，存储在服务器端的内存中，在session对象中也可以存储多条数据，每一条数据都有一个sessionid做为唯一标识。</p>
<p>![](E:\Tb前端资源笔记\11-16 前后端交互\11-13node+express\笔记\images\图片14.png)</p>
<p>在node.js中需要借助express-session实现session功能。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> session = <span class="built_in">require</span>(<span class="string">&#x27;express-session&#x27;</span>);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">session</span>(&#123; <span class="attr">secret</span>: <span class="string">&#x27;secret key&#x27;</span> &#125;));</span><br></pre></td></tr></table></figure>

<h3 id="Joi"><a href="#Joi" class="headerlink" title="Joi"></a>Joi</h3><p>JavaScript对象的规则描述语言和验证器。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Joi</span> = <span class="built_in">require</span>(<span class="string">&#x27;joi&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> schema = &#123;</span><br><span class="line">    <span class="attr">username</span>: <span class="title class_">Joi</span>.<span class="title function_">string</span>().<span class="title function_">alphanum</span>().<span class="title function_">min</span>(<span class="number">3</span>).<span class="title function_">max</span>(<span class="number">30</span>).required().<span class="title function_">error</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(‘错误信息’)),</span><br><span class="line">    <span class="attr">password</span>: <span class="title class_">Joi</span>.<span class="title function_">string</span>().<span class="title function_">regex</span>(<span class="regexp">/^[a-zA-Z0-9]&#123;3,30&#125;$/</span>),</span><br><span class="line">    <span class="attr">access_token</span>: [<span class="title class_">Joi</span>.<span class="title function_">string</span>(), <span class="title class_">Joi</span>.<span class="title function_">number</span>()],</span><br><span class="line">    <span class="attr">birthyear</span>: <span class="title class_">Joi</span>.<span class="title function_">number</span>().<span class="title function_">integer</span>().<span class="title function_">min</span>(<span class="number">1900</span>).<span class="title function_">max</span>(<span class="number">2013</span>),</span><br><span class="line">    <span class="attr">email</span>: <span class="title class_">Joi</span>.<span class="title function_">string</span>().<span class="title function_">email</span>()</span><br><span class="line">&#125;;</span><br><span class="line"><span class="title class_">Joi</span>.<span class="title function_">validate</span>(&#123; <span class="attr">username</span>: <span class="string">&#x27;abc&#x27;</span>, <span class="attr">birthyear</span>: <span class="number">1994</span> &#125;, schema);</span><br></pre></td></tr></table></figure>



<h3 id="formidable"><a href="#formidable" class="headerlink" title="formidable"></a>formidable</h3><p>作用：解析表单，支持get请求参数，post请求参数、文件上传。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入formidable模块</span></span><br><span class="line"><span class="keyword">const</span> formidable = <span class="built_in">require</span>(<span class="string">&#x27;formidable&#x27;</span>);</span><br><span class="line"><span class="comment">// 创建表单解析对象</span></span><br><span class="line"><span class="keyword">const</span> form = <span class="keyword">new</span> formidable.<span class="title class_">IncomingForm</span>();</span><br><span class="line"><span class="comment">// 设置文件上传路径</span></span><br><span class="line">form.<span class="property">uploadDir</span> = <span class="string">&quot;/my/dir&quot;</span>;</span><br><span class="line"><span class="comment">// 是否保留表单上传文件的扩展名</span></span><br><span class="line">form.<span class="property">keepExtensions</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="comment">// 对表单进行解析</span></span><br><span class="line">form.<span class="title function_">parse</span>(req, <span class="function">(<span class="params">err, fields, files</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// fields 存储普通请求参数</span></span><br><span class="line">        <span class="comment">// files 存储上传的文件信息</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h3 id="FileReader即时预览"><a href="#FileReader即时预览" class="headerlink" title="FileReader即时预览"></a>FileReader即时预览</h3><p>![](E:\Tb前端资源笔记\11-16 前后端交互\11-13node+express\笔记\images\图片15.png)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// html5方法</span></span><br><span class="line"><span class="keyword">var</span> reader = <span class="keyword">new</span> <span class="title class_">FileReader</span>();</span><br><span class="line">reader.<span class="title function_">readAsDataURL</span>(<span class="string">&#x27;文件&#x27;</span>);</span><br><span class="line">reader.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(reader.<span class="property">result</span>); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="数据分页-mongoose-sex-page"><a href="#数据分页-mongoose-sex-page" class="headerlink" title="数据分页 mongoose-sex-page"></a>数据分页 mongoose-sex-page</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pagination = <span class="built_in">require</span>(<span class="string">&#x27;mongoose-sex-page&#x27;</span>);</span><br><span class="line"><span class="title function_">pagination</span>(集合构造函数).<span class="title function_">page</span>(<span class="number">1</span>) .<span class="title function_">size</span>(<span class="number">20</span>) .<span class="title function_">display</span>(<span class="number">8</span>) .<span class="title function_">exec</span>();</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fangjun120.github.io/2022/02/05/00-00-00/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Fang Jun">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="eidolon的小窝">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/02/05/00-00-00/" class="post-title-link" itemprop="url">express框架</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-02-05 00:00:00" itemprop="dateCreated datePublished" datetime="2022-02-05T00:00:00+08:00">2022-02-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-04-09 10:21:30" itemprop="dateModified" datetime="2023-04-09T10:21:30+08:00">2023-04-09</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/node/" itemprop="url" rel="index"><span itemprop="name">node</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="框架简介"><a href="#框架简介" class="headerlink" title="框架简介"></a>框架简介</h2><p>Express是一个基于Node平台的web应用开发框架，提供了一系列的强大特性，帮助创建各种Web应用。可以使用<code>npm install express</code>命令下载。</p>
<h4 id="框架特性"><a href="#框架特性" class="headerlink" title="框架特性"></a>框架特性</h4><ul>
<li><p>提供了方便简洁的路由定义方式</p>
</li>
<li><p>对获取HTTP请求参数进行了简化处理</p>
</li>
<li><p>对模板引擎支持程度高，方便渲染动态HTML页面</p>
</li>
<li><p>提供了中间件机制有效控制HTTP请求</p>
</li>
<li><p>拥有大量第三方中间件对功能进行扩展</p>
</li>
</ul>
<h4 id="初体验"><a href="#初体验" class="headerlink" title="初体验"></a>初体验</h4><p>使用Express框架创建web服务器很简单，调用express模块返回的函数即可。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入Express框架</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="comment">// 使用框架创建web服务器</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="comment">// 当客户端以get方式访问/路由时</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">   <span class="comment">// 对客户端做出响应 </span></span><br><span class="line">   <span class="comment">// send方法会根据内容的类型自动设置请求头</span></span><br><span class="line">   <span class="comment">// send方法会检测响应内容的类型</span></span><br><span class="line">    <span class="comment">// send方法会自动设置http状态码</span></span><br><span class="line">   res.<span class="title function_">send</span>(<span class="string">&#x27;Hello Express&#x27;</span>); <span class="comment">// &lt;h2&gt;Hello Express&lt;/h2&gt; &#123;say: &#x27;hello&#x27;&#125;</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 程序监听3000端口</span></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>



<h2 id="中间件"><a href="#中间件" class="headerlink" title="中间件"></a>中间件</h2><p>中间件就是一堆方法，可以接收客户端发来的请求、可以对请求做出响应，也可以将请求继续交给下一个中间件继续处理。</p>
<p>![](E:\Tb前端资源笔记\11-16 前后端交互\11-13node+express\笔记\images\图片11.png)</p>
<p>中间件主要由两部分构成，中间件方法以及请求处理函数。</p>
<p>中间件方法由Express提供，负责拦截请求，请求处理函数由开发人员提供，负责处理请求。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;请求路径&#x27;</span>, <span class="string">&#x27;处理函数&#x27;</span>)   <span class="comment">// 接收并处理get请求</span></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;请求路径&#x27;</span>, <span class="string">&#x27;处理函数&#x27;</span>)  <span class="comment">// 接收并处理post请求</span></span><br></pre></td></tr></table></figure>

<p>可以针对同一个请求设置多个中间件，对同一个请求进行多次处理。</p>
<p>默认情况下，请求<strong>从上到下依次匹配</strong>中间件，一旦匹配成功，终止匹配。</p>
<p>可以调用next方法将请求的控制权交给下一个中间件，直到遇到结束请求的中间件。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/request&#x27;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    req.<span class="property">name</span> = <span class="string">&quot;张三&quot;</span>;</span><br><span class="line">    <span class="title function_">next</span>();</span><br><span class="line">&#125;);</span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/request&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(req.<span class="property">name</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="app-use中间件"><a href="#app-use中间件" class="headerlink" title="app.use中间件"></a>app.use中间件</h3><p>app.use 匹配所有的请求方式，可以直接传入请求处理函数，代表接收所有的请求。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">url</span>);</span><br><span class="line">    <span class="title function_">next</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>app.use 第一个参数也可以传入请求地址，代表不论什么请求方式，只要是这个请求地址就接收这个请求。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/admin&#x27;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">url</span>);</span><br><span class="line">    <span class="title function_">next</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="中间件应用"><a href="#中间件应用" class="headerlink" title="中间件应用"></a>中间件应用</h3><ol>
<li><p>路由保护，客户端在访问需要登录的页面时，可以先使用中间件判断用户登录状态，用户如果未登录，则拦截请求，直接响应，禁止用户进入需要登录的页面。</p>
</li>
<li><p>网站维护公告，在所有路由的最上面定义接收所有请求的中间件，直接为客户端做出响应，网站正在维护中。</p>
</li>
<li><p>自定义404页面</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 网站公告</span></span><br><span class="line"><span class="comment">// app.use((req, res, next) =&gt; &#123;</span></span><br><span class="line"><span class="comment">// 	res.send(&#x27;当前网站正在维护...&#x27;)</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/admin&#x27;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="comment">// 用户没有登录</span></span><br><span class="line">	<span class="keyword">let</span> isLogin = <span class="literal">true</span>;</span><br><span class="line">	<span class="comment">// 如果用户登录</span></span><br><span class="line">	<span class="keyword">if</span> (isLogin) &#123;</span><br><span class="line">		<span class="comment">// 让请求继续向下执行</span></span><br><span class="line">		<span class="title function_">next</span>()</span><br><span class="line">	&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="comment">// 如果用户没有登录 直接对客户端做出响应</span></span><br><span class="line">		res.<span class="title function_">send</span>(<span class="string">&#x27;您还没有登录 不能访问/admin这个页面&#x27;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/admin&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">	res.<span class="title function_">send</span>(<span class="string">&#x27;您已经登录 可以访问当前页面&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="comment">// 为客户端响应404状态码以及提示信息</span></span><br><span class="line">	res.<span class="title function_">status</span>(<span class="number">404</span>).<span class="title function_">send</span>(<span class="string">&#x27;当前访问的页面是不存在的&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="错误处理中间件"><a href="#错误处理中间件" class="headerlink" title="错误处理中间件"></a>错误处理中间件</h3><p>在程序执行的过程中，不可避免的会出现一些无法预料的错误，比如文件读取失败，数据库连接失败。程序一旦出错就无法继续运行，如果想要继续运行，必须捕获错误，加入错误处理</p>
<p>错误处理中间件是一个集中处理错误的地方。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> app.<span class="title function_">use</span>(<span class="function">(<span class="params">err, req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">     res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="string">&#x27;服务器发生未知错误&#x27;</span>);</span><br><span class="line"> &#125;)</span><br><span class="line"><span class="comment">// 同步程序出错后，会自动捕获</span></span><br></pre></td></tr></table></figure>

<p>当异步程序出现错误时，需调用next()方法，并且将错误信息通过参数的形式传递给next()方法，即可触发错误处理中间件。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> app.<span class="title function_">get</span>(<span class="string">&quot;/&quot;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">     fs.<span class="title function_">readFile</span>(<span class="string">&quot;/file-does-not-exist&quot;</span>, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">         <span class="keyword">if</span> (err != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="title function_">next</span>(err);</span><br><span class="line">            <span class="comment">// next不加参数代表传递给下一个中间件</span></span><br><span class="line">            <span class="comment">// 加了参数就代表传递给错误处理中间件</span></span><br><span class="line">         &#125;</span><br><span class="line">     &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="捕获错误"><a href="#捕获错误" class="headerlink" title="捕获错误"></a>捕获错误</h3><p>在node.js中，异步API的错误信息都是通过回调函数获取的，支持Promise对象的异步API发生错误可以通过catch方法捕获。异步函数执行如果发生错误要如何捕获错误呢？</p>
<p>try catch 可以捕获异步函数以及其他同步代码在执行过程中发生的错误，但是不能捕获其他类型的API发生的错误。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/&quot;</span>, <span class="keyword">async</span> (req, res, next) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> <span class="title class_">User</span>.<span class="title function_">find</span>(&#123;<span class="attr">name</span>: <span class="string">&#x27;张三&#x27;</span>&#125;)</span><br><span class="line">    &#125;<span class="keyword">catch</span>(ex) &#123;</span><br><span class="line">        <span class="title function_">next</span>(ex);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h2 id="框架请求处理"><a href="#框架请求处理" class="headerlink" title="框架请求处理"></a>框架请求处理</h2><h3 id="模块化路由"><a href="#模块化路由" class="headerlink" title="模块化路由"></a>模块化路由</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 基础代码</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>) </span><br><span class="line"><span class="comment">// 创建路由对象</span></span><br><span class="line"><span class="keyword">const</span> home = express.<span class="title class_">Router</span>();</span><br><span class="line"><span class="comment">// 将路由和请求路径进行匹配</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/home&#x27;</span>, home); <span class="comment">// 一级路由</span></span><br><span class="line"> <span class="comment">// 在home路由下继续创建路由</span></span><br><span class="line">home.<span class="title function_">get</span>(<span class="string">&#x27;/index&#x27;</span>, <span class="function">() =&gt;</span> &#123; <span class="comment">// 二级路由</span></span><br><span class="line">         <span class="comment">//  /home/index</span></span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&#x27;欢迎来到博客展示页面&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构建模块化路由</span></span><br><span class="line"><span class="comment">// home.js</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>) </span><br><span class="line"><span class="keyword">const</span> home = express.<span class="title class_">Router</span>(); </span><br><span class="line">home.<span class="title function_">get</span>(<span class="string">&#x27;/index&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;欢迎来到博客展示页面&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = home; <span class="comment">// 路由成员作为模块成员导出</span></span><br><span class="line"><span class="comment">// admin.js</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>) </span><br><span class="line"><span class="keyword">const</span> admin = express.<span class="title class_">Router</span>();</span><br><span class="line">admin.<span class="title function_">get</span>(<span class="string">&#x27;/index&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;欢迎来到博客管理页面&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = admin;</span><br><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="keyword">const</span> home = <span class="built_in">require</span>(<span class="string">&#x27;./route/home.js&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> admin = <span class="built_in">require</span>(<span class="string">&#x27;./route/admin.js&#x27;</span>);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/home&#x27;</span>, home);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/admin&#x27;</span>, admin);</span><br></pre></td></tr></table></figure>

<h3 id="GET参数获取"><a href="#GET参数获取" class="headerlink" title="GET参数获取"></a>GET参数获取</h3><p>Express框架中使用<code>req.query</code>即可获取GET参数，框架内部会将GET参数转换为对象并返回。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 接收地址栏中问号后面的参数</span></span><br><span class="line"><span class="comment">// 例如: http://localhost:3000/?name=zhangsan&amp;age=30</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">query</span>); <span class="comment">// &#123;&quot;name&quot;: &quot;zhangsan&quot;, &quot;age&quot;: &quot;30&quot;&#125;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="POST参数获取"><a href="#POST参数获取" class="headerlink" title="POST参数获取"></a>POST参数获取</h3><p>Express中接收post请求参数需要借助第三方包 body-parser。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入body-parser模块</span></span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>);</span><br><span class="line"><span class="comment">// 配置body-parser模块</span></span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">urlencoded</span>(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</span><br><span class="line"><span class="comment">// 接收请求</span></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/add&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">   <span class="comment">// 接收请求参数</span></span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">body</span>);</span><br><span class="line">&#125;) </span><br></pre></td></tr></table></figure>



<h3 id="路由参数"><a href="#路由参数" class="headerlink" title="路由参数"></a>路由参数</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 指定请求路由需要的参数，写在冒号后面</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/find/:id&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123; </span><br><span class="line">     <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">params</span>); <span class="comment">// &#123;id: 123&#125; </span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端请求链接</span></span><br><span class="line"><span class="attr">localhost</span>:<span class="number">3000</span>/find/<span class="number">123</span></span><br></pre></td></tr></table></figure>



<h3 id="静态资源的处理"><a href="#静态资源的处理" class="headerlink" title="静态资源的处理"></a>静态资源的处理</h3><p>通过Express内置的<strong>express.static</strong>可以方便地托管静态文件，例如img、CSS、JavaScript 文件等。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(<span class="string">&#x27;public&#x27;</span>));</span><br></pre></td></tr></table></figure>

<p>现在，public 目录下面的静态资源文件就可以访问了。</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="http://localhost:3000/images/kitten.jpg">http://localhost:3000/images/kitten.jpg</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="http://localhost:3000/css/style.css">http://localhost:3000/css/style.css</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="http://localhost:3000/js/app.js">http://localhost:3000/js/app.js</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="http://localhost:3000/images/bg.png">http://localhost:3000/images/bg.png</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="http://localhost:3000/hello.html">http://localhost:3000/hello.html</a></p>
</li>
</ul>
<h2 id="模板引擎"><a href="#模板引擎" class="headerlink" title="模板引擎"></a>模板引擎</h2><p>为了使art-template模板引擎能够更好的和Express框架配合，模板引擎官方在原art-template模板引擎的基础上封装了express-art-template。</p>
<p>使用<code>npm install art-template express-art-template</code>命令进行安装。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 当渲染后缀为art的模板时 使用express-art-template模板引擎</span></span><br><span class="line">app.<span class="title function_">engine</span>(<span class="string">&#x27;art&#x27;</span>, <span class="built_in">require</span>(<span class="string">&#x27;express-art-template&#x27;</span>));</span><br><span class="line"> <span class="comment">// 设置模板存放目录</span></span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&#x27;views&#x27;</span>, path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;views&#x27;</span>));</span><br><span class="line"> <span class="comment">// 渲染模板时不写后缀 默认拼接art后缀</span></span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&#x27;view engine&#x27;</span>, <span class="string">&#x27;art&#x27;</span>);</span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 渲染模板</span></span><br><span class="line">    res.<span class="title function_">render</span>(<span class="string">&#x27;index&#x27;</span>);</span><br><span class="line">&#125;); </span><br></pre></td></tr></table></figure>

<h3 id="app-locals-对象"><a href="#app-locals-对象" class="headerlink" title="app.locals 对象"></a>app.locals 对象</h3><p>将变量设置到app.locals对象下面，这个数据在所有的模板中都可以获取到。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> app.<span class="property">locals</span>.<span class="property">users</span> = [&#123;</span><br><span class="line">     <span class="attr">name</span>: <span class="string">&#x27;张三&#x27;</span>,</span><br><span class="line">     <span class="attr">age</span>: <span class="number">20</span></span><br><span class="line"> &#125;,&#123;</span><br><span class="line">     <span class="attr">name</span>: <span class="string">&#x27;李四&#x27;</span>,</span><br><span class="line">     <span class="attr">age</span>: <span class="number">20</span></span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fangjun120.github.io/2022/02/04/00-00-00/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Fang Jun">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="eidolon的小窝">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/02/04/00-00-00/" class="post-title-link" itemprop="url">模板引擎</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-02-04 00:00:00" itemprop="dateCreated datePublished" datetime="2022-02-04T00:00:00+08:00">2022-02-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-04-09 10:21:30" itemprop="dateModified" datetime="2023-04-09T10:21:30+08:00">2023-04-09</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/node/" itemprop="url" rel="index"><span itemprop="name">node</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p>模板引擎是第三方模块。</p>
<p>让开发者以更加友好的方式拼接字符串，使项目代码更加清晰、易于维护。</p>
<h3 id="art-template模板引擎"><a href="#art-template模板引擎" class="headerlink" title="art-template模板引擎"></a>art-template模板引擎</h3><ol>
<li><p>在命令行工具中使用<code>npm install art-template</code>命令进行下载</p>
</li>
<li><p>使用<code>const template = require(&#39;art-template&#39;)</code>引入模板引擎</p>
</li>
<li><p>告诉模板引擎要拼接的数据和模板在哪 <code>const html = template(‘模板路径’, 数据);</code></p>
</li>
<li><p>使用模板语法告诉模板引擎，模板与数据应该如何进行拼接</p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入模板引擎模块</span></span><br><span class="line"><span class="keyword">const</span> template = <span class="built_in">require</span>(<span class="string">&#x27;art-template&#x27;</span>);</span><br><span class="line"><span class="comment">// 将特定模板与特定数据进行拼接</span></span><br><span class="line"><span class="comment">// 第一个参数是模板文件路径，规定是.art，实际里面是HTML文件</span></span><br><span class="line"><span class="comment">// 第二个参数是一个对象，是传递的参数</span></span><br><span class="line"><span class="keyword">const</span> html = <span class="title function_">template</span>(<span class="string">&#x27;./views/index.art&#x27;</span>,&#123;</span><br><span class="line">   <span class="attr">data</span>: &#123;</span><br><span class="line">       <span class="attr">name</span>: <span class="string">&#x27;张三&#x27;</span>,</span><br><span class="line">       <span class="attr">age</span>: <span class="number">20</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;); </span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--模板文件，需传递name和age--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;data.name&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;data.age&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h2><p>art-template同时支持两种模板语法：标准语法和原始语法。</p>
<p>标准语法可以让模板更容易读写，原始语法具有强大的逻辑处理能力。</p>
<ul>
<li><p>标准语法： </p>
</li>
<li><p>原始语法：&lt;%&#x3D;数据 %&gt;</p>
</li>
</ul>
<h3 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">&lt;!-- 标准语法 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123;value&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123;a ? b : c&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123;a + b&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">&lt;!-- 原始语法 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>&lt;%= value %&gt;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>&lt;%= a ? b : c %&gt;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>&lt;%= a + b %&gt;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="原文输出"><a href="#原文输出" class="headerlink" title="原文输出"></a>原文输出</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--如果数据中携带HTML标签，默认模板引擎不会解析标签，会将其转义后输出。--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--如果确保数据安全，可以让模板引擎直接解析，即原文输出--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 标准语法 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123;@ value &#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 原始语法 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>&lt;%- value %&gt;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="条件判断"><a href="#条件判断" class="headerlink" title="条件判断"></a>条件判断</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 标准语法 --&gt;</span> </span><br><span class="line">&#123;&#123;if 条件&#125;&#125; ... &#123;&#123;/if&#125;&#125;</span><br><span class="line">&#123;&#123;if v1&#125;&#125; ... &#123;&#123;else if v2&#125;&#125; ... &#123;&#123;/if&#125;&#125;</span><br><span class="line"><span class="comment">&lt;!-- 原始语法 --&gt;</span></span><br><span class="line">&lt;% if (value) &#123; %&gt; ... &lt;% &#125; %&gt;</span><br><span class="line">&lt;% if (v1) &#123; %&gt; ... &lt;% &#125; else if (v2) &#123; %&gt; ... &lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure>

<h3 id="循环"><a href="#循环" class="headerlink" title="循环"></a>循环</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 标准语法 --&gt;</span></span><br><span class="line">&#123;&#123;each target&#125;&#125;</span><br><span class="line">    &#123;&#123;$index&#125;&#125; &#123;&#123;$value&#125;&#125;</span><br><span class="line">&#123;&#123;/each&#125;&#125;</span><br><span class="line"> <span class="comment">&lt;!-- 原始语法 --&gt;</span></span><br><span class="line">&lt;% for(var i = 0; i &lt; target.length; i++)&#123; %&gt;</span><br><span class="line">    &lt;%= i %&gt; &lt;%= target[i] %&gt;</span><br><span class="line">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure>

<h3 id="子模板"><a href="#子模板" class="headerlink" title="子模板"></a>子模板</h3><p>使用子模板可以将网站公共区块(头部、底部)抽离到单独的文件中。</p>
<p>哪里需要引入就写到哪里</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">  标准语法：&#123;&#123;include &#x27;模板&#x27;&#125;&#125;</span></span><br><span class="line"><span class="comment">  原始语法：&lt;%include(&#x27;模板&#x27;) %&gt;</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 标准语法 --&gt;</span></span><br><span class="line"> &#123;&#123;include &#x27;./header.art&#x27;&#125;&#125;</span><br><span class="line">  <span class="comment">&lt;!-- 原始语法 --&gt;</span></span><br><span class="line"> &lt;% include(&#x27;./header.art&#x27;) %&gt;</span><br></pre></td></tr></table></figure>

<h3 id="模板继承"><a href="#模板继承" class="headerlink" title="模板继承"></a>模板继承</h3><p>使用模板继承可以将网站HTML骨架抽离到单独的文件中，其他页面模板可以继承骨架文件。</p>
<p>![](E:\Tb前端资源笔记\11-16 前后端交互\11-13node+express\笔记\images\图片10.png)</p>
<p>不同页面在继承骨架文件时，需要填充的css，js和页面主体内容都不一样</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>HTML骨架模板<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--预留位置用于填充，head是位置名称--&gt;</span></span><br><span class="line">        &#123;&#123;block &#x27;head&#x27;&#125;&#125;&#123;&#123;/block&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        &#123;&#123;block &#x27;content&#x27;&#125;&#125;&#123;&#123;/block&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--index.art 首页模板--&gt;</span></span><br><span class="line">&#123;&#123;extend &#x27;./layout.art&#x27;&#125;&#125; <span class="comment">&lt;!--继承骨架模板--&gt;</span></span><br><span class="line">&#123;&#123;block &#x27;head&#x27;&#125;&#125; <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;custom.css&quot;</span>&gt;</span> &#123;&#123;/block&#125;&#125;</span><br><span class="line">&#123;&#123;block &#x27;content&#x27;&#125;&#125; <span class="tag">&lt;<span class="name">p</span>&gt;</span>This is just an awesome page.<span class="tag">&lt;/<span class="name">p</span>&gt;</span> &#123;&#123;/block&#125;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="模板配置"><a href="#模板配置" class="headerlink" title="模板配置"></a>模板配置</h3><ol>
<li><p>向模板中导入外部变量 template.defaults.imports.变量名 &#x3D; 变量值;</p>
</li>
<li><p>设置模板根目录 template.defaults.root &#x3D; 模板目录</p>
</li>
<li><p>设置模板默认后缀 template.defaults.extname &#x3D; ‘.art’</p>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fangjun120.github.io/2022/02/03/00-00-00/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Fang Jun">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="eidolon的小窝">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/02/03/00-00-00/" class="post-title-link" itemprop="url">MongoDB数据库</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-02-03 00:00:00" itemprop="dateCreated datePublished" datetime="2022-02-03T00:00:00+08:00">2022-02-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-04-09 10:21:30" itemprop="dateModified" datetime="2023-04-09T10:21:30+08:00">2023-04-09</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/node/" itemprop="url" rel="index"><span itemprop="name">node</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="MongoDB数据库"><a href="#MongoDB数据库" class="headerlink" title="MongoDB数据库"></a>MongoDB数据库</h1><h3 id="相关概念"><a href="#相关概念" class="headerlink" title="相关概念"></a>相关概念</h3><table>
<thead>
<tr>
<th>术语</th>
<th>解释说明</th>
</tr>
</thead>
<tbody><tr>
<td>database</td>
<td>数据库，一个数据库软件可以建立多个数据库</td>
</tr>
<tr>
<td>collection</td>
<td>集合，一组数据的集合，相当于sql中的表</td>
</tr>
<tr>
<td>document</td>
<td>文档，一条具体的数据，相当于sql表中的一行</td>
</tr>
<tr>
<td>field</td>
<td>字段，文档中属性的名称</td>
</tr>
</tbody></table>
<h3 id="Mongoose第三方包"><a href="#Mongoose第三方包" class="headerlink" title="Mongoose第三方包"></a>Mongoose第三方包</h3><p>使用Node.js操作MongoDB数据库需要依赖第三方包mongoose</p>
<p>使用<code>npm install mongoose</code>命令下载</p>
<h3 id="连接使用"><a href="#连接使用" class="headerlink" title="连接使用"></a>连接使用</h3><ol>
<li><p>在命令行工具中运行<code>net start mongoDB</code>即可启动MongoDB，否则MongoDB将无法连接。</p>
</li>
<li><pre><code class="js">const mongoose = require(&#39;mongoose&#39;);
// 使用mongoose提供的connect方法即可连接数据库。
mongoose.connect(&#39;mongodb://localhost/数据库名称&#39;)
// 在MongoDB中不需要显式创建数据库，如果不存在，会自动创建。
    .then(() =&gt; console.log(&#39;数据库连接成功&#39;))
    .catch(err =&gt; console.log(&#39;数据库连接失败&#39;, err));
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">3. 在MongoDB中**不需要显式创建数据库**，如果正在使用的数据库不存在会自动创建。</span><br><span class="line"></span><br><span class="line">## 增删改查</span><br><span class="line"></span><br><span class="line">### 创建集合</span><br><span class="line"></span><br><span class="line">创建集合分为两步，一是对**对集合设定规则**，二是**创建集合**，创建mongoose.Schema构造函数的实例即可创建集合。</span><br><span class="line"></span><br><span class="line">```js</span><br><span class="line">  // 设定集合规则</span><br><span class="line"> const courseSchema = new mongoose.Schema(&#123;</span><br><span class="line">     name: String,</span><br><span class="line">     author: String,</span><br><span class="line">     isPublished: Boolean</span><br><span class="line"> &#125;);</span><br><span class="line">  // 创建集合并应用规则</span><br><span class="line">  // 创建了一个名为Course的集合，MongoDB会生成一个courses的集合</span><br><span class="line"> const Course = mongoose.model(&#x27;Course&#x27;, courseSchema); </span><br><span class="line"> // 返回值是一个构造函数</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ol>
<p>虽然已经创建了数据库和集合，但没有插入数据，系统就不会创建</p>
<h3 id="mongoose验证"><a href="#mongoose验证" class="headerlink" title="mongoose验证"></a>mongoose验证</h3><p>在创建集合规则时，可以设置当前字段的验证规则，验证失败就则输入插入失败。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">required</span>: <span class="literal">true</span> <span class="comment">//必传字段</span></span><br><span class="line">minlength：<span class="number">3</span> <span class="comment">//字符串最小长度</span></span><br><span class="line"><span class="attr">maxlength</span>: <span class="number">20</span> <span class="comment">//字符串最大长度</span></span><br><span class="line"><span class="attr">min</span>: <span class="number">2</span> <span class="comment">//数值最小为2</span></span><br><span class="line"><span class="attr">max</span>: <span class="number">100</span> <span class="comment">//数值最大为100</span></span><br><span class="line"><span class="attr">enum</span>: [<span class="string">&#x27;html&#x27;</span>, <span class="string">&#x27;css&#x27;</span>, <span class="string">&#x27;javascript&#x27;</span>, <span class="string">&#x27;node.js&#x27;</span>]</span><br><span class="line"><span class="attr">trim</span>: <span class="literal">true</span> <span class="comment">//去除字符串两边的空格</span></span><br><span class="line"><span class="attr">validate</span>: <span class="comment">//自定义验证器</span></span><br><span class="line"><span class="attr">default</span>: <span class="comment">//默认值</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> courseSchema = <span class="keyword">new</span> mongoose.<span class="title class_">Schema</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">        <span class="attr">required</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="comment">// required: [true, &#x27;请传入文章名字&#x27;]</span></span><br><span class="line">        <span class="comment">// 后一个参数为自定义错误信息</span></span><br><span class="line">        <span class="attr">minlength</span>: [<span class="number">2</span>, <span class="string">&#x27;长度不能小于2&#x27;</span>],</span><br><span class="line">        <span class="attr">maxlength</span>: <span class="number">5</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">author</span>: &#123;</span><br><span class="line">    	<span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">        <span class="attr">validate</span>: &#123; <span class="comment">//自定义验证器</span></span><br><span class="line">            <span class="attr">validator</span>: <span class="function"><span class="params">v</span> =&gt;</span> &#123; <span class="comment">//v是当前插入时用户传入的值，对v验证</span></span><br><span class="line">                <span class="comment">// 返回bool值，true验证成功；false验证失败</span></span><br><span class="line">                <span class="keyword">return</span> v &amp;&amp; v.<span class="property">length</span> &gt; <span class="number">4</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">message</span>: <span class="string">&#x27;不符合规则&#x27;</span> <span class="comment">// 自定义错误信息</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">category</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">        <span class="attr">enum</span>: &#123;</span><br><span class="line">            <span class="attr">values</span>: [<span class="string">&#x27;html&#x27;</span>,<span class="string">&#x27;css&#x27;</span>,<span class="string">&#x27;js&#x27;</span>],</span><br><span class="line">            <span class="attr">messages</span>: <span class="string">&#x27;分类名称要在指定范围内&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>获取错误信息：<code>error.errors[&#39;字段名称&#39;].message</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Course</span>.<span class="title function_">create</span>(&#123;<span class="attr">name</span>: <span class="string">&#x27;JavaScript基础&#x27;</span>,<span class="attr">isPublish</span>: <span class="literal">true</span>&#125;)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">result</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(result))</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    	<span class="comment">// 获取错误信息对象</span></span><br><span class="line">    	<span class="keyword">const</span> err = error.<span class="property">errors</span>;</span><br><span class="line">    	<span class="keyword">for</span>(<span class="keyword">var</span> attr <span class="keyword">in</span> err)&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(err[attr][<span class="string">&#x27;message&#x27;</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>



<h3 id="创建文档"><a href="#创建文档" class="headerlink" title="创建文档"></a>创建文档</h3><p>创建文档实际上就是向集合中插入数据。</p>
<h5 id="方法一："><a href="#方法一：" class="headerlink" title="方法一："></a>方法一：</h5><ol>
<li>创建集合实例。</li>
<li>调用实例对象下的save方法将数据保存到数据库中。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 创建集合实例</span></span><br><span class="line"><span class="keyword">const</span> course = <span class="keyword">new</span> <span class="title class_">Course</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Node.js course&#x27;</span>,</span><br><span class="line">    <span class="attr">author</span>: <span class="string">&#x27;讲师&#x27;</span>,</span><br><span class="line">    <span class="attr">tags</span>: [<span class="string">&#x27;node&#x27;</span>, <span class="string">&#x27;backend&#x27;</span>],</span><br><span class="line">    <span class="attr">isPublished</span>: <span class="literal">true</span></span><br><span class="line">&#125;);</span><br><span class="line"> <span class="comment">// 将数据保存到数据库中</span></span><br><span class="line">course.<span class="title function_">save</span>();</span><br></pre></td></tr></table></figure>

<h5 id="方法二："><a href="#方法二：" class="headerlink" title="方法二："></a>方法二：</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Course</span>.<span class="title function_">create</span>(&#123;<span class="attr">name</span>: <span class="string">&#x27;JavaScript基础&#x27;</span>, <span class="attr">author</span>: <span class="string">&#x27;黑马讲师&#x27;</span>, <span class="attr">isPublish</span>: <span class="literal">true</span>&#125;, <span class="function">(<span class="params">err, doc</span>) =&gt;</span> &#123; </span><br><span class="line">     <span class="comment">//  错误对象</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">     <span class="comment">//  当前插入的文档</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(doc)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Course</span>.<span class="title function_">create</span>(&#123;<span class="attr">name</span>: <span class="string">&#x27;JavaScript基础&#x27;</span>, <span class="attr">author</span>: <span class="string">&#x27;黑马讲师&#x27;</span>, <span class="attr">isPublish</span>: <span class="literal">true</span>&#125;)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function"><span class="params">doc</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(doc))</span><br><span class="line">      .<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(err))</span><br></pre></td></tr></table></figure>

<h3 id="导入数据"><a href="#导入数据" class="headerlink" title="导入数据"></a>导入数据</h3><p>找到mongodb数据库的安装目录，将安装目录下的bin目录放置在环境变量中。</p>
<p>mongoimport -d 数据库名称 -c 集合名称 –file 要导入的数据文件</p>
<h3 id="查询文档"><a href="#查询文档" class="headerlink" title="查询文档"></a>查询文档</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  根据条件查找文档（条件为空则查找所有文档）</span></span><br><span class="line"><span class="title class_">Course</span>.<span class="title function_">find</span>().<span class="title function_">then</span>(<span class="function"><span class="params">result</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(result))</span><br><span class="line"><span class="comment">// find方法返回文档集合</span></span><br><span class="line"><span class="comment">// 输出结果为</span></span><br><span class="line">[&#123;</span><br><span class="line">    <span class="attr">_id</span>: 5c0917ed37ec9b03c07cf95f,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;node.js基础&#x27;</span>,</span><br><span class="line">    <span class="attr">author</span>: <span class="string">&#x27;黑马讲师‘</span></span><br><span class="line"><span class="string">&#125;,&#123;</span></span><br><span class="line"><span class="string">     _id: 5c09dea28acfb814980ff827,</span></span><br><span class="line"><span class="string">     name: &#x27;</span><span class="title class_">Javascript</span><span class="string">&#x27;,</span></span><br><span class="line"><span class="string">     author: &#x27;</span>黑马讲师‘</span><br><span class="line">&#125;]</span><br><span class="line"></span><br><span class="line"><span class="comment">//  根据条件查找文档</span></span><br><span class="line"><span class="title class_">Course</span>.<span class="title function_">find</span>(&#123;<span class="attr">name</span>: <span class="string">&#x27;node.js基础&#x27;</span>&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">result</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(result)) <span class="comment">// 返回所有满足条件的，返回值是数组</span></span><br><span class="line"><span class="comment">// 返回第一条满足条件的</span></span><br><span class="line"><span class="title class_">Course</span>.<span class="title function_">findOne</span>(&#123;<span class="attr">name</span>: <span class="string">&#x27;node.js基础&#x27;</span>&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">result</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(result))</span><br><span class="line"><span class="comment">//  匹配大于 小于</span></span><br><span class="line"><span class="title class_">User</span>.<span class="title function_">find</span>(&#123;<span class="attr">age</span>: &#123;<span class="attr">$gt</span>: <span class="number">20</span>, <span class="attr">$lt</span>: <span class="number">50</span>&#125;&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">result</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(result))</span><br><span class="line"><span class="comment">//  匹配包含</span></span><br><span class="line"><span class="title class_">User</span>.<span class="title function_">find</span>(&#123;<span class="attr">hobbies</span>: &#123;<span class="attr">$in</span>: [<span class="string">&#x27;敲代码&#x27;</span>]&#125;&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">result</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(result))</span><br><span class="line"><span class="comment">//  选择要查询的字段  </span></span><br><span class="line"><span class="title class_">User</span>.<span class="title function_">find</span>().<span class="title function_">select</span>(<span class="string">&#x27;name email&#x27;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">result</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(result))</span><br><span class="line"><span class="comment">// 将数据按照年龄进行排序</span></span><br><span class="line"><span class="title class_">User</span>.<span class="title function_">find</span>().<span class="title function_">sort</span>(<span class="string">&#x27;age&#x27;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">result</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(result))</span><br><span class="line"><span class="comment">//  skip 跳过多少条数据  limit 限制查询数量 在分页查询时用到</span></span><br><span class="line"><span class="title class_">User</span>.<span class="title function_">find</span>().<span class="title function_">skip</span>(<span class="number">2</span>).<span class="title function_">limit</span>(<span class="number">2</span>).<span class="title function_">then</span>(<span class="function"><span class="params">result</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(result))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="删除文档"><a href="#删除文档" class="headerlink" title="删除文档"></a>删除文档</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 删除单个</span></span><br><span class="line"><span class="title class_">Course</span>.<span class="title function_">findOneAndDelete</span>(&#123;name : <span class="string">&#x27;王五&#x27;</span>&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">result</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(result))</span><br><span class="line"> <span class="comment">// 删除多个，不传查询条件则删除全部</span></span><br><span class="line"><span class="title class_">User</span>.<span class="title function_">deleteMany</span>(&#123;查询条件&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">result</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(result))</span><br></pre></td></tr></table></figure>

<h3 id="修改文档"><a href="#修改文档" class="headerlink" title="修改文档"></a>修改文档</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 更新单个</span></span><br><span class="line"><span class="title class_">User</span>.<span class="title function_">updateOne</span>(&#123;查询条件&#125;, &#123;要修改的值&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">result</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(result))</span><br><span class="line"><span class="comment">// 更新多个</span></span><br><span class="line"><span class="title class_">User</span>.<span class="title function_">updateMany</span>(&#123;查询条件&#125;, &#123;要更改的值&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">result</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(result))</span><br></pre></td></tr></table></figure>

<h3 id="集合关联"><a href="#集合关联" class="headerlink" title="集合关联"></a>集合关联</h3><p>通常<strong>不同集合的数据之间是有关系的</strong>，例如文章信息和用户信息存储在不同集合中，但文章是某个用户发表的，要查询文章的所有信息包括发表用户，就需要用到集合关联。</p>
<ul>
<li><p>使用id对集合进行关联</p>
</li>
<li><p>使用populate方法进行关联集合查询</p>
</li>
</ul>
<p>![](E:\Tb前端资源笔记\11-16 前后端交互\11-13node+express\笔记\images\图片9.png)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用户集合</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">User</span> = mongoose.<span class="title function_">model</span>(<span class="string">&#x27;User&#x27;</span>, <span class="keyword">new</span> mongoose.<span class="title class_">Schema</span>(&#123; <span class="attr">name</span>: &#123; <span class="attr">type</span>: <span class="title class_">String</span> &#125; &#125;)); </span><br><span class="line"><span class="comment">// 文章集合</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Post</span> = mongoose.<span class="title function_">model</span>(<span class="string">&#x27;Post&#x27;</span>, <span class="keyword">new</span> mongoose.<span class="title class_">Schema</span>(&#123;</span><br><span class="line">    <span class="attr">title</span>: &#123; <span class="attr">type</span>: <span class="title class_">String</span> &#125;,</span><br><span class="line">    <span class="comment">// 使用ID将文章集合和作者集合进行关联</span></span><br><span class="line">    <span class="attr">author</span>: &#123; <span class="attr">type</span>: mongoose.<span class="property">Schema</span>.<span class="property">Types</span>.<span class="property">ObjectId</span>, <span class="attr">ref</span>: <span class="string">&#x27;User&#x27;</span> &#125;</span><br><span class="line">&#125;));</span><br><span class="line"><span class="comment">//联合查询</span></span><br><span class="line"><span class="title class_">Post</span>.<span class="title function_">find</span>()</span><br><span class="line">      .<span class="title function_">populate</span>(<span class="string">&#x27;author&#x27;</span>)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function">(<span class="params">err, result</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(result));</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fangjun120.github.io/2022/02/02/00-00-00/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Fang Jun">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="eidolon的小窝">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/02/02/00-00-00/" class="post-title-link" itemprop="url">请求响应原理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-02-02 00:00:00" itemprop="dateCreated datePublished" datetime="2022-02-02T00:00:00+08:00">2022-02-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-04-09 10:20:27" itemprop="dateModified" datetime="2023-04-09T10:20:27+08:00">2023-04-09</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/node/" itemprop="url" rel="index"><span itemprop="name">node</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="服务器端基础"><a href="#服务器端基础" class="headerlink" title="服务器端基础"></a>服务器端基础</h2><h4 id="网站构成"><a href="#网站构成" class="headerlink" title="网站构成"></a>网站构成</h4><p>网站应用程序主要分为两大部分：客户端和服务器端。</p>
<ul>
<li><p>客户端：在浏览器中运行的部分，就是用户看到并与之交互的界面程序。使用HTML、CSS、JavaScript构建。</p>
</li>
<li><p>服务器端：在服务器中运行的部分，负责存储数据和处理应用逻辑。</p>
</li>
</ul>
<h4 id="Node网站服务器"><a href="#Node网站服务器" class="headerlink" title="Node网站服务器"></a>Node网站服务器</h4><p>能够提供网站访问服务的机器就是网站服务器，它能够接收客户端的请求，能够对请求做出响应。</p>
<h4 id="IP地址"><a href="#IP地址" class="headerlink" title="IP地址"></a>IP地址</h4><p>互联网中设备的唯一标识。IP是Internet Protocol Address的简写，代表互联网协议地址.</p>
<h4 id="域名"><a href="#域名" class="headerlink" title="域名"></a>域名</h4><p>由于IP地址难于记忆，所以产生了域名的概念，所谓域名就是平时<strong>上网所使用的网址</strong>。</p>
<p><a target="_blank" rel="noopener" href="http://www.itheima.com/">http://www.itheima.com</a> &#x3D;&gt; <a target="_blank" rel="noopener" href="http://124.165.219.100/">http://124.165.219.100/</a></p>
<p>虽然在地址栏中输入的是网址, 但是最终还是会将域名转换为ip才能访问到指定的网站服务器。</p>
<h4 id="端口"><a href="#端口" class="headerlink" title="端口"></a>端口</h4><p>端口是计算机与外界通讯交流的出口，用来区分服务器电脑中提供的不同的服务。端口号可以不提供，默认是80</p>
<p>![](E:\Tb前端资源笔记\11-16 前后端交互\11-13node+express\笔记\images\图片5.png)</p>
<h4 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h4><p>统一资源定位符，又叫URL(Uniform Resource Locator)，是专为标识Internet网上资源位置而设的一种编址方式，我们平时所说的网页地址指的即是URL。</p>
<p>组成</p>
<ul>
<li>传输协议:&#x2F;&#x2F;服务器IP或域名:端口&#x2F;资源所在位置标识</li>
<li><code>http://www.itcast.cn/news/20181018/09152238514.html</code></li>
</ul>
<h4 id="开发过程中客户端和服务器端说明"><a href="#开发过程中客户端和服务器端说明" class="headerlink" title="开发过程中客户端和服务器端说明"></a>开发过程中客户端和服务器端说明</h4><p>在开发阶段，客户端和服务器端使用<strong>同一台电脑</strong>，即开发人员电脑。</p>
<p>![](E:\Tb前端资源笔记\11-16 前后端交互\11-13node+express\笔记\images\图片6.png)</p>
<ul>
<li><p>本机域名：localhost</p>
</li>
<li><p>本地IP  ：127.0.0.1</p>
</li>
</ul>
<h2 id="创建web服务器"><a href="#创建web服务器" class="headerlink" title="创建web服务器"></a>创建web服务器</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">// 引用系统模块</span></span><br><span class="line"> <span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line">  <span class="comment">// 创建web服务器</span></span><br><span class="line"> <span class="keyword">const</span> app = http.<span class="title function_">createServer</span>();</span><br><span class="line">  <span class="comment">// 客户端的请求以事件的形式到达服务器端</span></span><br><span class="line">  <span class="comment">// 当客户端发送请求的时候</span></span><br><span class="line"> app.<span class="title function_">on</span>(<span class="string">&#x27;request&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">//  响应</span></span><br><span class="line">       res.<span class="title function_">end</span>(<span class="string">&#x27;&lt;h1&gt;hi, user&lt;/h1&gt;&#x27;</span>);</span><br><span class="line"> &#125;);</span><br><span class="line">  <span class="comment">// 监听3000端口</span></span><br><span class="line"> app.<span class="title function_">listen</span>(<span class="number">3000</span>);</span><br><span class="line"> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;服务器已启动，监听3000端口，请访问 localhost:3000&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 运行此文件并打开浏览器</span></span><br></pre></td></tr></table></figure>



<h2 id="HTTP协议"><a href="#HTTP协议" class="headerlink" title="HTTP协议"></a>HTTP协议</h2><h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><p><strong>超文本传输协议</strong>（HyperText Transfer Protocol）规定了如何从网站服务器传输超文本到本地浏览器，它基于客户端服务器架构工作，是客户端（用户）和服务器端（网站）<strong>请求和应答的标准</strong>。</p>
<h3 id="报文"><a href="#报文" class="headerlink" title="报文"></a>报文</h3><p>在HTTP请求和响应的过程中传递的数据块就叫报文，包括要传送的数据和一些附加信息，并且要遵守规定好的格式。</p>
<p>在浏览器右键检查中的Network可以查看报文</p>
<p>![](E:\Tb前端资源笔记\11-16 前后端交互\11-13node+express\笔记\images\图片8.png)</p>
<ul>
<li><p>请求报文</p>
<ol>
<li><p>请求方式 (Request Method)，告知服务器端当前事务的类型</p>
<ul>
<li>GET   请求数据</li>
<li>POST  发送数据，相对更安全</li>
</ul>
</li>
<li><p>请求地址 (Request URL)</p>
<ul>
<li><pre><code class="js">app.on(&#39;request&#39;, (req, res) =&gt; &#123;
    req.headers // 获取请求报文
    req.url   // 获取请求地址，根据地址的不同响应不同的内容
    req.method  // 获取请求方法
&#125;);
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 响应报文</span><br><span class="line"></span><br><span class="line">  1. HTTP状态码</span><br><span class="line">     - 200 请求成功</span><br><span class="line">     - 404 请求的资源没有被找到</span><br><span class="line">     - 500 服务器端错误</span><br><span class="line">     - 400 客户端请求有语法错误</span><br><span class="line"></span><br><span class="line">  2. 内容类型(默认为text/plain)</span><br><span class="line">     - text/html</span><br><span class="line">     - text/css</span><br><span class="line">     - application/javascript</span><br><span class="line">     - image/jpeg</span><br><span class="line">     - application/json</span><br><span class="line"></span><br><span class="line">```js</span><br><span class="line"> app.on(&#x27;request&#x27;, (req, res) =&gt; &#123;</span><br><span class="line">     // 设置响应报文</span><br><span class="line">     res.writeHead(200, &#123;</span><br><span class="line">         &#x27;Content-Type&#x27;: &#x27;text/html;charset=utf8&#x27;</span><br><span class="line">     &#125;);</span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
</li>
</ol>
</li>
</ul>
<h2 id="HTTP请求与响应处理"><a href="#HTTP请求与响应处理" class="headerlink" title="HTTP请求与响应处理"></a>HTTP请求与响应处理</h2><h3 id="请求参数"><a href="#请求参数" class="headerlink" title="请求参数"></a>请求参数</h3><ul>
<li><p>GET参数</p>
<ul>
<li><p><strong>参数被放置在浏览器地址栏</strong>中，例如<a target="_blank" rel="noopener" href="http://localhost:3000/?name=zhangsan&age=20%60">http://localhost:3000/?name=zhangsan&amp;age=20`</a></p>
</li>
<li><p>参数获取需要借助系统模块url，url模块用来处理url地址</p>
</li>
<li><pre><code class="js"> const http = require(&#39;http&#39;);
 // 导入url系统模块 用于处理url地址
 const url = require(&#39;url&#39;);
 const app = http.createServer();
 app.on(&#39;request&#39;, (req, res) =&gt; &#123;
     // 将url路径的各个部分解析出来并返回对象
         // true 代表将参数解析为对象格式
     let &#123;query&#125; = url.parse(req.url, true);
     console.log(query);
 &#125;);
 app.listen(3000);
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- POST参数</span><br><span class="line"></span><br><span class="line">  - 参数被放置在请求体中进行传输</span><br><span class="line"></span><br><span class="line">  - 获取POST参数需要使用data事件和end事件,且不是一次就传输完的</span><br><span class="line"></span><br><span class="line">  - 使用querystring系统模块将参数转换为对象格式</span><br><span class="line"></span><br><span class="line">  - ```js</span><br><span class="line">     // 导入系统模块querystring 用于将HTTP参数转换为对象格式</span><br><span class="line">     const querystring = require(&#x27;querystring&#x27;);</span><br><span class="line">     app.on(&#x27;request&#x27;, (req, res) =&gt; &#123;</span><br><span class="line">         let postData = &#x27;&#x27;;</span><br><span class="line">         // 监听参数传输事件</span><br><span class="line">         req.on(&#x27;data&#x27;, (chunk) =&gt; postData += chunk;);</span><br><span class="line">         // 拼接POST参数</span><br><span class="line">         // 监听参数传输完毕事件</span><br><span class="line">         req.on(&#x27;end&#x27;, () =&gt; &#123; </span><br><span class="line">             console.log(querystring.parse(postData)); </span><br><span class="line">         &#125;); </span><br><span class="line">     &#125;);</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
</li>
</ul>
<h3 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h3><p>路由是指客户端请求地址与服务器端程序代码的对应关系。简单的说，就是请求什么响应什么。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 当客户端发来请求的时候</span></span><br><span class="line">app.<span class="title function_">on</span>(<span class="string">&#x27;request&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 获取客户端的请求路径</span></span><br><span class="line">    <span class="keyword">let</span> &#123; pathname &#125; = url.<span class="title function_">parse</span>(req.<span class="property">url</span>);</span><br><span class="line">    <span class="keyword">if</span> (pathname == <span class="string">&#x27;/&#x27;</span> || pathname == <span class="string">&#x27;/index&#x27;</span>) &#123;</span><br><span class="line">        res.<span class="title function_">end</span>(<span class="string">&#x27;欢迎来到首页&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pathname == <span class="string">&#x27;/list&#x27;</span>) &#123;</span><br><span class="line">        res.<span class="title function_">end</span>(<span class="string">&#x27;欢迎来到列表页&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       res.<span class="title function_">end</span>(<span class="string">&#x27;抱歉, 您访问的页面出游了&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h3 id="静态资源和动态资源"><a href="#静态资源和动态资源" class="headerlink" title="静态资源和动态资源"></a>静态资源和动态资源</h3><ul>
<li><p>服务器端不需要处理，可以直接响应给客户端的资源就是静态资源，例如CSS、JavaScript、image文件。</p>
</li>
<li><p>相同的请求地址不同的响应资源，这种资源就是动态资源。</p>
</li>
</ul>
<h2 id="异步编程"><a href="#异步编程" class="headerlink" title="异步编程"></a>异步编程</h2><ul>
<li><p>同步API：只有当前API执行完成后，才能继续执行下一个API</p>
<ul>
<li><pre><code class="js">console.log(&#39;before&#39;); 
console.log(&#39;after&#39;);
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 异步API：当前API的执行不会阻塞后续代码的执行</span><br><span class="line"></span><br><span class="line">  - ```js</span><br><span class="line">    console.log(&#x27;before&#x27;);</span><br><span class="line">    setTimeout(</span><br><span class="line">       () =&gt; &#123; console.log(&#x27;last&#x27;);</span><br><span class="line">    &#125;, 2000);</span><br><span class="line">    console.log(&#x27;after&#x27;);</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
</li>
<li><p>同步API可以从返回值中拿到API执行的结果, 但是异步API是不可以的</p>
<ul>
<li><pre><code class="js">// 同步
function sum (n1, n2) &#123; 
    return n1 + n2;
&#125; 
const result = sum (10, 20);//可以得到返回值

// 异步
function getMsg () &#123; 
    setTimeout(function () &#123; 
        return &#123; msg: &#39;Hello Node.js&#39; &#125;
    &#125;, 2000);
&#125;
const msg = getMsg (); 
console.log(msg);  // 得不到返回值，undefined
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 要获取异步API的执行结果需要用回调函数</span><br><span class="line"></span><br><span class="line">  - ```js</span><br><span class="line">    function getMsg (callback) &#123;</span><br><span class="line">        setTimeout(function () &#123;</span><br><span class="line">            // </span><br><span class="line">            callback (&#123; msg: &#x27;Hello Node.js&#x27; &#125;)</span><br><span class="line">        &#125;, 2000);</span><br><span class="line">    &#125;</span><br><span class="line">    getMsg (function (msg) &#123; </span><br><span class="line">        console.log(msg);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
</li>
</ul>
<h3 id="回调地狱"><a href="#回调地狱" class="headerlink" title="回调地狱"></a>回调地狱</h3><p><strong>如果异步API后面代码的执行依赖当前异步API的执行结果，但实际上后续代码在执行的时候异步API还没有返回结果，这个问题要怎么解决呢？</strong></p>
<p>答：可以将依赖项写到回调函数中，但这样会造成回调函数嵌套过多</p>
<p>比如：<strong>依次</strong>读取A、B、C文件，A的回调函数中要写B，B的回调函数中要写C</p>
<p>当嵌套层数太多时，可读性和可维护性很差，通常称这样的代码为回调地狱</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line">fs.<span class="title function_">readFile</span>(<span class="string">&#x27;./1.txt&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>, <span class="function">(<span class="params">err, result1</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(result1)</span><br><span class="line">	fs.<span class="title function_">readFile</span>(<span class="string">&#x27;./2.txt&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>, <span class="function">(<span class="params">err, result2</span>) =&gt;</span> &#123;</span><br><span class="line">		<span class="variable language_">console</span>.<span class="title function_">log</span>(result2)</span><br><span class="line">		fs.<span class="title function_">readFile</span>(<span class="string">&#x27;./3.txt&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>, <span class="function">(<span class="params">err, result3</span>) =&gt;</span> &#123;</span><br><span class="line">			<span class="variable language_">console</span>.<span class="title function_">log</span>(result3)</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h3 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h3><p>Promise出现的目的是解决Node.js异步编程中回调地狱的问题。是异步编程语法上的改进，<strong>将异步API的执行和结果的处理分离</strong>。</p>
<p>实际就是在原本的异步API外面包裹一层，提供了两个方法，当有返回结果时，若成功则用resolve将结果传递到外面；失败则用reject将结果传递</p>
<p>基本语法如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// resolve用于传递异步API的执行结果</span></span><br><span class="line">    <span class="comment">// reject用于异步API失败的结果传递到外面去</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(&#123;<span class="attr">name</span>: <span class="string">&#x27;张三&#x27;</span>&#125;)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_">reject</span>(<span class="string">&#x27;失败了&#x27;</span>) </span><br><span class="line">        &#125; </span><br><span class="line">    &#125;, <span class="number">2000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 在promise外面拿到结果</span></span><br><span class="line">promise.<span class="title function_">then</span>(<span class="function"><span class="params">result</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(result); </span><br><span class="line">             <span class="comment">// then对应resolve</span></span><br><span class="line">             <span class="comment">// &#123;name: &#x27;张三&#x27;&#125;)</span></span><br><span class="line">       .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(error); </span><br><span class="line">			<span class="comment">// 失败了</span></span><br></pre></td></tr></table></figure>
<p>解决回调地狱：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">p1</span> () &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span> (<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">		fs.<span class="title function_">readFile</span>(<span class="string">&#x27;./1.txt&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">			<span class="title function_">resolve</span>(result)</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">p2</span> () &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span> (<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">		fs.<span class="title function_">readFile</span>(<span class="string">&#x27;./2.txt&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">			<span class="title function_">resolve</span>(result)</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">p3</span> () &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span> (<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">		fs.<span class="title function_">readFile</span>(<span class="string">&#x27;./3.txt&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">			<span class="title function_">resolve</span>(result)</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">p1</span>().<span class="title function_">then</span>(<span class="function">(<span class="params">r1</span>)=&gt;</span> &#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(r1);</span><br><span class="line">	<span class="keyword">return</span> <span class="title function_">p2</span>();</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">then</span>(<span class="function">(<span class="params">r2</span>)=&gt;</span> &#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(r2);</span><br><span class="line">	<span class="keyword">return</span> <span class="title function_">p3</span>();</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">then</span>(<span class="function">(<span class="params">r3</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(r3)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="异步函数"><a href="#异步函数" class="headerlink" title="异步函数"></a>异步函数</h3><p>异步函数是异步编程语法的终极解决方案，它可以让我们将异步代码写成同步的形式，让代码不再有回调函数嵌套，使代码变得清晰明了。</p>
<p>定义：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 异步函数默认的返回值是promise对象</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">fn</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fn</span> () &#123;&#125;</span><br></pre></td></tr></table></figure>

<h4 id="async关键字"><a href="#async关键字" class="headerlink" title="async关键字"></a>async关键字</h4><ol>
<li><p>普通函数定义前加async关键字 普通函数变成异步函数</p>
</li>
<li><p>异步函数默认返回promise对象</p>
</li>
<li><p>在异步函数内部使用return关键字进行结果返回 结果会被包裹的promise对象中 return关键字代替了resolve方法</p>
</li>
<li><p>在异步函数内部使用throw关键字抛出程序异常</p>
</li>
<li><p>调用异步函数再链式调用then方法获取异步函数执行结果</p>
</li>
<li><p>调用异步函数再链式调用catch方法获取异步函数执行的错误信息</p>
</li>
</ol>
<h4 id="await关键字"><a href="#await关键字" class="headerlink" title="await关键字"></a>await关键字</h4><ol>
<li><p>await关键字只能出现在异步函数中</p>
</li>
<li><p>await后面只能写promise对象 写其他类型的API是不可以的</p>
</li>
<li><p><strong>await可暂停异步函数向下执行，直到promise返回结果后再向下执行，同时可以拿到函数的返回值</strong></p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">p1</span> () &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&#x27;p1&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">p2</span> () &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&#x27;p2&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">p3</span> () &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&#x27;p3&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">run</span> () &#123;</span><br><span class="line">	<span class="keyword">let</span> r1 = <span class="keyword">await</span> <span class="title function_">p1</span>()</span><br><span class="line">	<span class="keyword">let</span> r2 = <span class="keyword">await</span> <span class="title function_">p2</span>()</span><br><span class="line">	<span class="keyword">let</span> r3 = <span class="keyword">await</span> <span class="title function_">p3</span>()</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(r1)</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(r2)</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(r3)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">run</span>();</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="comment">// 改造现有异步函数api 让其返回promise对象 从而支持异步函数语法</span></span><br><span class="line"><span class="keyword">const</span> promisify = <span class="built_in">require</span>(<span class="string">&#x27;util&#x27;</span>).<span class="property">promisify</span>;</span><br><span class="line"><span class="comment">// 调用promisify方法改造现有异步API 让其返回promise对象</span></span><br><span class="line"><span class="keyword">const</span> readFile = <span class="title function_">promisify</span>(fs.<span class="property">readFile</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">run</span> () &#123;</span><br><span class="line">	<span class="keyword">let</span> r1 = <span class="keyword">await</span> <span class="title function_">readFile</span>(<span class="string">&#x27;./1.txt&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">	<span class="keyword">let</span> r2 = <span class="keyword">await</span> <span class="title function_">readFile</span>(<span class="string">&#x27;./2.txt&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">	<span class="keyword">let</span> r3 = <span class="keyword">await</span> <span class="title function_">readFile</span>(<span class="string">&#x27;./3.txt&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(r1)</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(r2)</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(r3)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">run</span>();</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fangjun120.github.io/2022/02/01/09-35-24/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Fang Jun">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="eidolon的小窝">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/02/01/09-35-24/" class="post-title-link" itemprop="url">node入门</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-02-01 09:35:24" itemprop="dateCreated datePublished" datetime="2022-02-01T09:35:24+08:00">2022-02-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-04-09 10:20:47" itemprop="dateModified" datetime="2023-04-09T10:20:47+08:00">2023-04-09</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/node/" itemprop="url" rel="index"><span itemprop="name">node</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Node是什么"><a href="#Node是什么" class="headerlink" title="Node是什么"></a>Node是什么</h2><p>Node是一个基于Chrome V8引擎的JavaScript代码运行环境。</p>
<p>Node.js是由<strong>ECMAScript</strong>及<strong>Node 环境</strong>提供的一些<strong>附加API</strong>组成的，包括文件、网络、路径等等一些更加强大的 API。因此ES语法在node中完全可以使用。</p>
<p>在Node环境下执行代码，需要先定位到文件所在的文件夹，再使用Node命令执行后缀为.js的文件即可</p>
<blockquote>
<p>node test.js</p>
</blockquote>
<p>node的全局对象是global，有以下方法</p>
<blockquote>
<p>console.log()   在控制台中输出</p>
<p>setTimeout()   设置超时定时器</p>
<p>clearTimeout() 清除超时时定时器</p>
<p>setInterval()   设置间歇定时器</p>
<p>clearInterval()  清除间歇定时</p>
</blockquote>
<h2 id="模块化开发"><a href="#模块化开发" class="headerlink" title="模块化开发"></a>模块化开发</h2><p>JavaScript在使用时存在两大问题，<strong>文件依赖</strong>和<strong>命名冲突。</strong></p>
<p>采用模块化开发的形式不需要人为地维护文件依赖，由文件自动实现，且文件与文件之间是半封闭状态，只将需要访问的代码开放出去</p>
<h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><p>一个功能就是一个模块，多个模块可以组成完整应用，抽离一个模块不会影响其他功能的运行。</p>
<p><img src="/images/%E5%9B%BE%E7%89%871.png"></p>
<h3 id="Node-js中模块化开发规范"><a href="#Node-js中模块化开发规范" class="headerlink" title="Node.js中模块化开发规范"></a>Node.js中模块化开发规范</h3><p>Node.js规定<strong>一个JavaScript文件就是一个模块</strong>，模块内部定义的变量和函数默认情况下在外部无法得到</p>
<p>模块内部可以使用<code>exports</code>对象进行成员导出，使用<code>require</code>方法导入其他模块。（导入时文件路径中的.js可以省略）</p>
<p><img src="/images/%E5%9B%BE%E7%89%872.png"></p>
<h5 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// a.js</span></span><br><span class="line"><span class="keyword">let</span> version = <span class="number">1.0</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">sayHi</span> = name =&gt; <span class="string">`您好, <span class="subst">$&#123;name&#125;</span>`</span>;</span><br><span class="line"><span class="comment">// 向模块外部导出数据 </span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">version</span> = version;</span><br><span class="line"><span class="built_in">exports</span>.<span class="property">sayHi</span> = sayHi;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// b.js</span></span><br><span class="line"> <span class="comment">// 在b.js模块中导入模块a</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="built_in">require</span>(<span class="string">&#x27;./b.js&#x27;</span>);</span><br><span class="line"> <span class="comment">// 输出b模块中的version变量</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a.<span class="property">version</span>);</span><br><span class="line"> <span class="comment">// 调用b模块中的sayHi方法 并输出其返回值</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a.<span class="title function_">sayHi</span>(<span class="string">&#x27;hello&#x27;</span>)); </span><br></pre></td></tr></table></figure>

<h5 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 模块成员的第二种导出方法</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span>.<span class="property">version</span> = version;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span>.<span class="property">sayHi</span> = sayHi;</span><br></pre></td></tr></table></figure>

<h5 id="两种方法的区别"><a href="#两种方法的区别" class="headerlink" title="两种方法的区别"></a>两种方法的区别</h5><p>exports是module.exports的别名(地址引用关系)，<strong>导出对象最终以module.exports为准</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> = &#123;</span><br><span class="line">	<span class="attr">name</span>:<span class="string">&#x27;zhangsan&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">export</span> = &#123; <span class="comment">// 当两者冲突时，以module.export为准</span></span><br><span class="line">	<span class="attr">name</span>:<span class="string">&#x27;lisi&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="系统模块"><a href="#系统模块" class="headerlink" title="系统模块"></a>系统模块</h2><h3 id="概念-1"><a href="#概念-1" class="headerlink" title="概念"></a>概念</h3><p>就是Node运行环境提供的API。因为这些API都是以模块化的方式进行开发的, 所以称其为系统模块</p>
<h3 id="文件操作系统模块fs"><a href="#文件操作系统模块fs" class="headerlink" title="文件操作系统模块fs"></a>文件操作系统模块fs</h3><p><img src="/images/%E5%9B%BE%E7%89%873.png"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 引入fs模块</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用该模块提供的API</span></span><br><span class="line">fs.<span class="title function_">reaFile</span>(<span class="string">&#x27;文件路径/文件名称&#x27;</span>[,<span class="string">&#x27;文件编码&#x27;</span>], callback); </span><br><span class="line">fs.<span class="title function_">writeFile</span>(<span class="string">&#x27;文件路径/文件名称&#x27;</span>, <span class="string">&#x27;数据&#x27;</span>, callback);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 例子</span></span><br><span class="line"><span class="keyword">const</span> content = <span class="string">&#x27;&lt;h3&gt;正在使用fs.writeFile写入文件内容&lt;/h3&gt;&#x27;</span>;</span><br><span class="line">fs.<span class="title function_">writeFile</span>(<span class="string">&#x27;../index.html&#x27;</span>, content, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err != <span class="literal">null</span>) &#123; </span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;文件写入成功&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h3 id="路径系统模块path"><a href="#路径系统模块path" class="headerlink" title="路径系统模块path"></a>路径系统模块path</h3><p>为什么要进行路径拼接</p>
<ul>
<li>不同操作系统的路径分隔符不统一</li>
<li>Windows是<code>\ / </code>      Linux(常用作服务器，必须考虑)是&#x2F;</li>
</ul>
<h4 id="路径拼接-根据不同的OS选择不同的拼接符"><a href="#路径拼接-根据不同的OS选择不同的拼接符" class="headerlink" title="路径拼接  根据不同的OS选择不同的拼接符"></a>路径拼接  根据不同的OS选择不同的拼接符</h4><blockquote>
<p>path**.<strong>join</strong>(<strong>‘路径’</strong>,** ‘路径’<strong>,</strong> …)</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 导入path模块</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"> <span class="comment">// 路径拼接</span></span><br><span class="line"><span class="keyword">let</span> finialPath = path.<span class="title function_">join</span>(<span class="string">&#x27;itcast&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c.css&#x27;</span>);</span><br><span class="line"> <span class="comment">// 输出结果 itcast\a\b\c.css</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(finialPath);</span><br></pre></td></tr></table></figure>

<h5 id="绝对路径和相对路径"><a href="#绝对路径和相对路径" class="headerlink" title="绝对路径和相对路径"></a>绝对路径和相对路径</h5><ul>
<li><p>大多数情况下使用绝对路径，因为相对路径有时候相对的是命令行工具的当前工作目录</p>
</li>
<li><p>在读取文件或者设置文件路径时都会选择绝对路径</p>
</li>
<li><p>使用<code>__dirname</code>获取当前文件所在的绝对路径</p>
</li>
</ul>
<h2 id="第三方模块（包）"><a href="#第三方模块（包）" class="headerlink" title="第三方模块（包）"></a>第三方模块（包）</h2><h3 id="概念-2"><a href="#概念-2" class="headerlink" title="概念"></a>概念</h3><p>别人写好的、具有特定功能的、我们能直接使用的模块即第三方模块，由于第三方模块通常都是由多个文件组成并且被放置在一个文件夹中，所以又名包。</p>
<h3 id="存在形式"><a href="#存在形式" class="headerlink" title="存在形式"></a>存在形式</h3><p>以js文件的形式存在，提供实现项目具体功能的API接口。</p>
<p>以命令行工具形式存在，辅助项目开发</p>
<h3 id="获取第三方模块"><a href="#获取第三方模块" class="headerlink" title="获取第三方模块"></a>获取第三方模块</h3><p><code>npmjs.com</code>是一个第三方模块的存储仓库，里面存储了大量的第三方模块。</p>
<p>它提供了<code>npm(node package manager):node的第三方模块管理工具</code>命令来下载第三方模块</p>
<blockquote>
<p>下载：npm install 模块名称</p>
<p>卸载：npm unintall package 模块名称</p>
</blockquote>
<ul>
<li>npm是一个命令行工具，本质上也是一个第三方模块，在安装node时已经集成安装了</li>
<li>在安装过程中需要注意安装模式（本地安装和全局安装），本地安装就是安装到当前项目；全局安装就是将模块安装到公共目录，所有项目都可以使用</li>
<li>一般而言，我们将命令行工具进行全局安装，将库文件进行本地安装</li>
</ul>
<h3 id="nodemon模块"><a href="#nodemon模块" class="headerlink" title="nodemon模块"></a>nodemon模块</h3><p>nodemon是一个命令行工具，用以辅助项目开发。</p>
<p>在Node.js中，每次修改文件都要在命令行工具中重新执行该文件，非常繁琐。该模块可以在文件保存以后 重新执行文件</p>
<h5 id="使用步骤"><a href="#使用步骤" class="headerlink" title="使用步骤"></a>使用步骤</h5><ol>
<li><p>使用<code>npm install nodemon –g</code> 下载它  -g就是全局安装</p>
</li>
<li><p>在命令行工具中用nodemon命令替代node命令执行文件</p>
</li>
<li><p>之后会挂起命令来监听保存文件操作，若要中断，按ctrl+c</p>
</li>
</ol>
<p><img src="/images/%E5%9B%BE%E7%89%874.png"></p>
<h3 id="nrm模块"><a href="#nrm模块" class="headerlink" title="nrm模块"></a>nrm模块</h3><p><code>nrm ( npm registry manager )</code>：npm下载地址切换工具，可以快速切换npm的下载地址</p>
<p>npm默认的下载地址在国外，国内下载速度慢</p>
<h5 id="使用步骤-1"><a href="#使用步骤-1" class="headerlink" title="使用步骤"></a>使用步骤</h5><ol>
<li><p>使用<code>npm install nrm –g </code>下载它</p>
</li>
<li><p>查询可用下载地址列表 <code>nrm ls</code></p>
</li>
<li><p>切换npm下载地址<code> nrm use 下载地址名称</code></p>
</li>
</ol>
<h3 id="Gulp模块"><a href="#Gulp模块" class="headerlink" title="Gulp模块"></a>Gulp模块</h3><p>基于node平台开发的前端构建工具</p>
<p>将机械化操作编写成任务, 想要执行机械化操作时执行一个命令行命令，任务就能自动执行，提高开发效率。</p>
<h5 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h5><ul>
<li><p>项目上线，HTML、CSS、JS文件压缩合并</p>
</li>
<li><p>语法转换（es6、less …）</p>
</li>
<li><p>公共文件抽离</p>
</li>
<li><p>修改文件后浏览器自动刷新</p>
</li>
</ul>
<h5 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h5><ol>
<li><p>使用<code>npm install gulp</code>下载gulp库文件</p>
</li>
<li><p>在项目根目录下建立<code>gulpfile.js</code>文件</p>
</li>
<li><p>重构项目的文件夹结构src目录放置源代码文件 dist目录放置构建后文件</p>
</li>
<li><p>在gulpfile.js文件中编写任务.</p>
</li>
<li><p>在命令行工具中执行gulp任务</p>
<ul>
<li>gulpfile.js文件中写有很多个task，如果使用node命令执行该文件，会执行整个文件</li>
<li>若只是执行单个task，可使用gulp提供的同名命令行工具<ul>
<li><code>npm install gulp-cli -g</code>安装gulp命令行工具</li>
<li><code>gulp 任务名</code>执行某个具体任务</li>
</ul>
</li>
</ul>
</li>
</ol>
<h5 id="Gulp提供的方法"><a href="#Gulp提供的方法" class="headerlink" title="Gulp提供的方法"></a>Gulp提供的方法</h5><ul>
<li><p>gulp.src()：获取任务要处理的文件</p>
</li>
<li><p>gulp.dest()：输出文件</p>
</li>
<li><p>gulp.task()：建立gulp任务</p>
</li>
<li><p>gulp.watch()：监控文件的变化</p>
</li>
<li><p>其他的大量方法通过插件实现</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// gulpfile.js</span></span><br><span class="line"><span class="comment">// 引入模块</span></span><br><span class="line"><span class="keyword">const</span> gulp = <span class="built_in">require</span>(<span class="string">&#x27;gulp&#x27;</span>);</span><br><span class="line"> <span class="comment">// 使用gulp.task()方法建立任务</span></span><br><span class="line"> <span class="comment">// first为任务名，以区分多个不同的任务</span></span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&#x27;first&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">   <span class="comment">// 获取要处理的文件</span></span><br><span class="line">   gulp.<span class="title function_">src</span>(<span class="string">&#x27;./src/css/base.css&#x27;</span>) </span><br><span class="line">   <span class="comment">// 将处理后的文件输出到dist目录</span></span><br><span class="line">   <span class="comment">// 用pipe方法处理代码</span></span><br><span class="line">       .<span class="title function_">pipe</span>(gulp.<span class="title function_">dest</span>(<span class="string">&#x27;./dist/css&#x27;</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h5 id="Gulp插件"><a href="#Gulp插件" class="headerlink" title="Gulp插件"></a>Gulp插件</h5><ul>
<li><p>gulp-htmlmin ：html文件压缩</p>
<ul>
<li><pre><code class="js">// 引用
const htmlmin = require(&#39;gulp-htmlmin&#39;);
const fileinclude = require(&#39;gulp-file-include&#39;);

// 1.html文件中代码的压缩操作
// 2.抽取html文件中的公共代码
gulp.task(&#39;htmlmin&#39;, () =&gt; &#123;
    gulp.src(&#39;./src/*.html&#39;)
        // 注意顺序，先抽取公共部分再压缩代码
        // 抽取公共代码
        .pipe(fileinclude())
        // 压缩html文件中的代码
        .pipe(htmlmin(&#123; collapseWhitespace: true &#125;))
        // 处理后的文件输出到dist文件夹
        .pipe(gulp.dest(&#39;dist&#39;));
&#125;);
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- gulp-csso ：压缩css</span><br><span class="line"></span><br><span class="line">  - ```js</span><br><span class="line">    const less = require(&#x27;gulp-less&#x27;);</span><br><span class="line">    const csso = require(&#x27;gulp-csso&#x27;);</span><br><span class="line">    // 1.less语法转换</span><br><span class="line">    // 2.css代码压缩</span><br><span class="line">    gulp.task(&#x27;cssmin&#x27;, () =&gt; &#123;</span><br><span class="line">        // 选择css目录下的所有less文件以及css文件</span><br><span class="line">        gulp.src([&#x27;./src/css/*.less&#x27;, &#x27;./src/css/*.css&#x27;])</span><br><span class="line">            // 将less语法转换为css语法</span><br><span class="line">            .pipe(less())</span><br><span class="line">            // 将css代码进行压缩</span><br><span class="line">            .pipe(csso())</span><br><span class="line">            // 将处理的结果进行输出</span><br><span class="line">            .pipe(gulp.dest(&#x27;dist/css&#x27;))</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
</li>
<li><p>gulp-babel ：JavaScript语法转化</p>
</li>
<li><p>gulp-less: less语法转化css语法</p>
</li>
<li><p>gulp-uglify ：压缩混淆JavaScript</p>
</li>
<li><p>gulp-file-include 公共文件包含</p>
</li>
<li><p>browsersync 浏览器实时同步</p>
</li>
<li><pre><code class="js">//任务统一执行

// 构建任务
gulp.task(&#39;default&#39;, [&#39;htmlmin&#39;, &#39;cssmin&#39;, &#39;jsmin&#39;, &#39;copy&#39;]);
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### package.json文件</span><br><span class="line"></span><br><span class="line">##### node_modules文件夹的问题</span><br><span class="line"></span><br><span class="line">1. 文件夹以及文件过多过碎，当我们将项目整体拷贝给别人的时候,，传输速度会很慢很慢. </span><br><span class="line"></span><br><span class="line">2. 复杂的模块**依赖关系**需要被记录，确保模块的版本和当前保持一致，否则会导致当前项目运行报错</span><br><span class="line"></span><br><span class="line">##### 依赖关系分为项目依赖和开发依赖</span><br><span class="line"></span><br><span class="line">- 项目依赖是在项目的开发阶段和线上运营阶段，都需要依赖的第三方包</span><br><span class="line">  - 使用`npm install 包名`命令下载的文件会默认被添加到 package.json 文件的 dependencies 字段中</span><br><span class="line">  - 使用`npm install --description`命令可以下载全部的项目依赖</span><br><span class="line">- 开发依赖是在项目的开发阶段需要，线上运营阶段不需要的第三方包，如gulp</span><br><span class="line">- 使用`npm install 包名 --save-dev`命令将包添加到package.json文件的devDependencies字段中</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">##### package.json文件</span><br><span class="line"></span><br><span class="line">项目描述文件，记录了当前项目信息，例如项目名称、版本、作者、github地址、当前项目依赖了哪些第三方模块等。</span><br><span class="line"></span><br><span class="line">使用`npm init -y`命令生成。一般放在项目根目录下</span><br><span class="line"></span><br><span class="line">- 有了这个文件，就不需要再传node_modules文件，使用`npm install`即可**下载全部的依赖**</span><br><span class="line"></span><br><span class="line">- 其中的`scripts`属性可以为长命令起一个别名，用`npm run 别名`</span><br><span class="line"></span><br><span class="line">- ```js</span><br><span class="line">  &quot;scripts&quot;: &#123;</span><br><span class="line">  &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;,</span><br><span class="line">  &quot;build&quot;: &quot;nodemon app.js&quot; </span><br><span class="line">      //使用npm run build即可</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
<h5 id="package-lock-json文件"><a href="#package-lock-json文件" class="headerlink" title="package-lock.json文件"></a>package-lock.json文件</h5><p>记录了模块之间的依赖关系，锁定包的版本，确保再次下载时不会因为包版本不同而产生问题</p>
<p>加快下载速度，因为该文件中已经记录了项目所依赖第三方包的树状结构和包的下载地址，重新安装时只需下载即可，不需要做额外的工作</p>
<h2 id="Node-js中的模块加载机制"><a href="#Node-js中的模块加载机制" class="headerlink" title="Node.js中的模块加载机制"></a>Node.js中的模块加载机制</h2><h3 id="当模块拥有路径但没有后缀时"><a href="#当模块拥有路径但没有后缀时" class="headerlink" title="当模块拥有路径但没有后缀时"></a>当模块拥有路径但没有后缀时</h3><blockquote>
<p>require**(**’.&#x2F;find’);</p>
</blockquote>
<p>1.require方法根据模块路径查找模块，如果是完整路径，直接引入模块。</p>
<p>2.如果模块后缀省略，先找同名JS文件,若找不到再找同名JS文件夹</p>
<p>3.如果找到了同名文件夹，找文件夹中的index.js</p>
<p>4.如果文件夹中没有index.js就会去当前文件夹中的package.json文件中查找main选项中的入口文件</p>
<p>5.如果找指定的入口文件不存在或者没有指定入口文件就会报错，模块没有被找到</p>
<h3 id="当模块没有路径且没有后缀时"><a href="#当模块没有路径且没有后缀时" class="headerlink" title="当模块没有路径且没有后缀时"></a>当模块没有路径且没有后缀时</h3><blockquote>
<p>require**(**’find’);</p>
</blockquote>
<p>1.Node.js会假设它是系统模块，若有则执行，若没有</p>
<p>2.Node.js会去node_modules文件夹中</p>
<p>3.首先看是否有同名的JS文件</p>
<p>4.再看是否有同名的文件夹</p>
<p>5.如果是文件夹看里面是否有index.js</p>
<p>6.如果没有index.js查看该文件夹中的package.json中的main选项确定模块入口文件</p>
<p>7.找不到就报错</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fangjun120.github.io/2020/12/01/11-56-16/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Fang Jun">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="eidolon的小窝">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/01/11-56-16/" class="post-title-link" itemprop="url">CSS3-浏览器私有前缀</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-12-01 11:56:16" itemprop="dateCreated datePublished" datetime="2020-12-01T11:56:16+08:00">2020-12-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-04-09 10:21:26" itemprop="dateModified" datetime="2023-04-09T10:21:26+08:00">2023-04-09</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CSS/" itemprop="url" rel="index"><span itemprop="name">CSS</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h2><blockquote>
<p>为了兼容老版本，新版本的浏览器无需添加</p>
</blockquote>
<h2 id="私有前缀"><a href="#私有前缀" class="headerlink" title="私有前缀"></a>私有前缀</h2><ul>
<li>-moz-：<code>Firefox</code>私有属性</li>
<li>-ms-：<code>ie</code>私有属性</li>
<li>-webkit-：<code>Safari</code>、<code>Chrome</code>私有属性</li>
<li>-o-：<code>Opera</code>私有属性</li>
</ul>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/12/01/11-56-16/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/5/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/7/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Fang Jun</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">92</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Fang Jun</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"right","width":200,"height":300},"mobile":{"show":false},"rect":"opacity:0.7","log":false,"pluginJsPath":"lib/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
